<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="حسینیه فدائیان ائمه اطهار - مرکز برگزاری مراسم مذهبی و عزاداری اهل بیت علیهم السلام">
  <meta name="keywords" content="حسینیه, ائمه اطهار, مراسم مذهبی, عزاداری, مداحی, دعا">
  <title>حسینیه فدائیان ائمه اطهار | مرکز مراسم مذهبی</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #800000;
      --secondary-color: #ffcc00;
      --bg-color: #1a1a1a;
      --text-color: #f0f0f0;
      --nav-bg: #0d0d0d;
      --section-bg: #222222;
      --card-bg: #2c2c2c;
      --border-color: #444444;
      --shadow-light: rgba(0, 0, 0, 0.2);
      --shadow-medium: rgba(0, 0, 0, 0.4);
      --shadow-dark: rgba(0, 0, 0, 0.6);
    }

    .light-mode {
      --primary-color: #9e0000;
      --secondary-color: #b8860b;
      --bg-color: #f5f5f5;
      --text-color: #333333;
      --nav-bg: #e0e0e0;
      --section-bg: #ffffff;
      --card-bg: #f9f9f9;
      --border-color: #dddddd;
      --shadow-light: rgba(0, 0, 0, 0.1);
      --shadow-medium: rgba(0, 0, 0, 0.15);
      --shadow-dark: rgba(0, 0, 0, 0.2);
    }
    
    body {
      font-family: 'Vazirmatn', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      padding: 0;
      line-height: 1.8;
      transition: all 0.3s ease;
      padding-bottom: 70px;
      overflow-x: hidden;
    }
    
    header {
      background-color: var(--primary-color);
      padding: 30px 20px;
      text-align: center;
      position: relative;
      color: white;
      box-shadow: 0 4px 15px var(--shadow-dark);
      background-image: linear-gradient(135deg, var(--primary-color) 0%, darken(var(--primary-color), 10%) 100%);
    }
    
    header h1 {
      margin: 0;
      font-size: 2.8rem;
      font-weight: 700;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.6);
      letter-spacing: 1px;
    }
    
    header p {
      font-size: 1.1rem;
      opacity: 0.9;
      margin-top: 10px;
    }

    .search-box {
      margin: 25px auto 10px;
      max-width: 500px;
      position: relative;
    }
    
    .search-box input {
      width: 100%;
      padding: 14px 45px 14px 20px;
      border-radius: 30px;
      border: none;
      font-size: 1.05rem;
      font-family: 'Vazirmatn', sans-serif;
      background-color: rgba(255, 255, 255, 0.95);
      color: #333;
      box-sizing: border-box;
      box-shadow: inset 0 1px 5px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .search-box input:focus {
        outline: none;
        box-shadow: 0 0 0 3px var(--secondary-color), inset 0 1px 5px rgba(0, 0, 0, 0.2);
    }
    
    .search-box button {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: #777;
      cursor: pointer;
      font-size: 1.1rem;
      padding: 0;
      transition: color 0.3s ease;
    }

    .search-box button:hover {
        color: #333;
    }

    /* استایل‌های جدید برای تاریخچه جستجو */
    .search-history {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background-color: var(--card-bg);
      border-radius: 0 0 15px 15px;
      box-shadow: 0 5px 15px var(--shadow-medium);
      z-index: 1000;
      max-height: 300px;
      overflow-y: auto;
      display: none;
      border: 1px solid var(--border-color);
      border-top: none;
    }
    
    .search-history.visible {
      display: block;
    }
    
    .search-history-item {
      padding: 10px 15px;
      cursor: pointer;
      transition: background-color 0.2s;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-color);
    }
    
    .search-history-item:last-child {
      border-bottom: none;
    }
    
    .search-history-item:hover {
      background-color: var(--primary-color);
      color: white;
    }
    
    .search-history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      border-bottom: 1px solid var(--border-color);
      background-color: var(--section-bg);
      color: var(--text-color);
    }
    
    .clear-history {
      background: none;
      border: none;
      color: var(--secondary-color);
      cursor: pointer;
      font-size: 0.9rem;
    }

    .clear-history:hover {
      text-decoration: underline;
    }
    
    /* استایل‌های بخش نتایج جستجو */
    .search-results {
      margin-top: 20px;
      background-color: var(--section-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 5px 15px var(--shadow-light);
      border: 1px solid var(--border-color);
    }
    
    .search-result-item {
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px dashed var(--border-color);
    }
    
    .search-result-item:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }
    
    .search-result-title {
      color: var(--secondary-color);
      font-size: 1.2rem;
      margin-bottom: 5px;
    }
    
    .search-result-link {
      color: var(--primary-color);
      text-decoration: none;
      font-size: 0.9rem;
    }
    
    .search-result-link:hover {
      text-decoration: underline;
    }
    
    .search-result-snippet {
      color: var(--text-color);
      margin-top: 5px;
      font-size: 0.95rem;
    }
    
    .highlight-search {
      background-color: rgba(var(--secondary-color-rgb), 0.3);
      padding: 0 2px;
      border-radius: 3px;
    }

    /* ناوبری جستجو */
    .search-navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid var(--border-color);
    }
    
    .search-nav-btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.3s;
    }
    
    .search-nav-btn:hover {
      background-color: darken(var(--primary-color), 10%);
    }
    
    .search-nav-btn:disabled {
      background-color: var(--border-color);
      cursor: not-allowed;
    }

    /* سایر استایل‌ها... */
    nav {
      background-color: var(--nav-bg);
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      padding: 10px 0;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 10px var(--shadow-medium);
    }
    
    nav a {
      color: white;
      text-decoration: none;
      margin: 5px 18px;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      padding: 8px 15px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    nav a:hover {
      color: var(--secondary-color);
      background-color: rgba(255, 255, 255, 0.15);
      transform: translateY(-2px);
    }

    nav a i {
        font-size: 1.2em;
    }
    
    .theme-toggle-nav {
      color: white;
      background: none;
      border: none;
      font-size: 1.4rem;
      cursor: pointer;
      margin: 5px 18px;
      transition: all 0.3s ease;
      padding: 8px;
      border-radius: 50%;
    }
    
    .theme-toggle-nav:hover {
      color: var(--secondary-color);
      background-color: rgba(255, 255, 255, 0.15);
    }
    
    .fa-sun { display: none; }
    .fa-moon { display: inline-block; }
    
    body.light-mode .fa-sun { display: inline-block; }
    body.light-mode .fa-moon { display: none; }
    
    .highlight {
      color: var(--secondary-color);
      font-weight: bold;
    }
    
    section {
      padding: 40px 20px;
      max-width: 1100px;
      margin: 30px auto;
      background-color: var(--section-bg);
      border-radius: 12px;
      box-shadow: 0 5px 20px var(--shadow-medium);
      position: relative;
      overflow: hidden;
    }

    section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
            radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0) 50%),
            radial-gradient(circle at 90% 80%, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0) 50%);
        background-size: 200px 200px;
        opacity: 0.1;
        pointer-events: none;
        z-index: 0;
    }

    section > * {
        position: relative;
        z-index: 1;
    }
    
    h2 {
      color: var(--secondary-color);
      font-size: 2.2rem;
      border-bottom: 3px solid var(--secondary-color);
      padding-bottom: 15px;
      margin-top: 0;
      text-align: center;
      position: relative;
      margin-bottom: 30px;
    }

    h2::after {
        content: '';
        position: absolute;
        bottom: -3px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 3px;
        background-color: var(--primary-color);
        border-radius: 5px;
    }
    
    h3 {
      color: var(--secondary-color);
      font-size: 1.5rem;
      margin-bottom: 15px;
    }
    
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
      margin-top: 25px;
    }
    
    .gallery-item {
      position: relative;
      overflow: hidden;
      border-radius: 10px;
      box-shadow: 0 6px 15px var(--shadow-light);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      background-color: var(--card-bg);
      border: 1px solid var(--border-color);
    }
    
    .gallery-item:hover {
      transform: translateY(-8px);
      box-shadow: 0 10px 25px var(--shadow-medium);
    }
    
    .gallery img {
      width: 100%;
      height: 220px;
      object-fit: cover;
      transition: transform 0.5s ease;
    }
    
    .gallery-item:hover img {
      transform: scale(1.08);
    }
    
    .gallery-caption {
      padding: 15px;
      text-align: center;
    }
    
    .gallery-caption h4 {
      margin: 0 0 5px 0;
      color: var(--secondary-color);
    }
    
    .gallery-caption p {
      margin: 0;
      font-size: 0.9rem;
      color: var(--text-color);
      opacity: 0.8;
    }
    
    .gallery-caption .date {
      font-size: 0.8rem;
      color: var(--secondary-color);
      margin-top: 5px;
    }
    
    .program-schedule {
      background-color: var(--card-bg);
      padding: 25px;
      border-radius: 12px;
      margin-top: 25px;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 10px var(--shadow-light);
    }
    
    .program-day {
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px dashed var(--border-color);
    }
    
    .program-day:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .program-day h3 {
      color: var(--secondary-color);
      margin-bottom: 10px;
      font-size: 1.6rem;
    }

    .program-day p {
        margin: 5px 0;
    }
    
    form {
      display: flex;
      flex-direction: column;
      gap: 18px;
      max-width: 700px;
      margin: 25px auto 0;
      padding: 25px;
      background-color: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 4px 10px var(--shadow-light);
      border: 1px solid var(--border-color);
    }
    
    input, textarea, button {
      padding: 14px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      font-size: 1.05rem;
      font-family: 'Vazirmatn', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: all 0.3s ease;
    }

    input::placeholder, textarea::placeholder {
        color: #999;
    }

    input:focus, textarea:focus {
        outline: none;
        border-color: var(--secondary-color);
        box-shadow: 0 0 0 3px rgba(var(--secondary-color-rgb), 0.3);
    }
    
    textarea {
      resize: vertical;
      min-height: 120px;
    }
    
    button {
      background-color: var(--primary-color);
      color: white;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    button:hover {
      background-color: darken(var(--primary-color), 10%);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(var(--primary-color-rgb), 0.4);
    }
    
    .social-links {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin: 25px 0;
      justify-content: center;
    }
    
    .social-link {
      display: flex;
      align-items: center;
      color: white;
      text-decoration: none;
      background-color: var(--primary-color);
      padding: 12px 20px;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-size: 1rem;
      box-shadow: 0 2px 5px var(--shadow-light);
    }
    
    .social-link:hover {
      background-color: darken(var(--primary-color), 10%);
      transform: translateY(-3px);
      box-shadow: 0 5px 15px var(--shadow-medium);
    }
    
    .social-link i {
      margin-left: 10px;
      font-size: 1.3rem;
    }
    
    footer {
      background-color: var(--nav-bg);
      color: #aaa;
      text-align: center;
      padding: 30px 20px 80px;
      margin-top: 50px;
      box-shadow: 0 -2px 10px var(--shadow-dark);
    }
    
    .back-to-top {
      position: fixed;
      bottom: 90px;
      left: 20px;
      background-color: var(--primary-color);
      color: white;
      width: 55px;
      height: 55px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.6rem;
      cursor: pointer;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      z-index: 99;
      border: none;
      box-shadow: 0 4px 10px var(--shadow-medium);
    }
    
    .back-to-top.visible {
      opacity: 1;
      visibility: visible;
    }
    
    .media-container {
      background-color: var(--card-bg);
      padding: 25px;
      border-radius: 12px;
      margin-top: 25px;
      border: 1px solid var(--border-color);
      position: relative;
      box-shadow: 0 6px 15px var(--shadow-light);
    }
    
    .media-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .media-title {
      color: var(--secondary-color);
      font-size: 1.8rem;
      margin: 0;
    }
    
    .media-controls {
      color: var(--secondary-color);
      font-size: 1.5rem;
    }
    
    .media-frame {
      width: 100%;
      height: 450px;
      border: none;
      border-radius: 8px;
      background-color: #000;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
    }
    
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: var(--nav-bg);
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
      z-index: 1000;
      box-shadow: 0 -5px 20px var(--shadow-dark);
      border-top: 1px solid var(--border-color);
      transition: transform 0.3s ease, opacity 0.3s ease;
      transform: translateY(100%);
      opacity: 0;
    }
    
    .bottom-nav.visible {
      transform: translateY(0);
      opacity: 1;
    }
    
    .bottom-nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: white;
      text-decoration: none;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      padding: 8px 10px;
      border-radius: 10px;
      min-width: 60px;
      text-align: center;
    }
    
    .bottom-nav-item i {
      font-size: 1.5rem;
      margin-bottom: 5px;
    }
    
    .bottom-nav-item:hover {
      background-color: rgba(255, 255, 255, 0.15);
      color: var(--secondary-color);
    }
    
    .bottom-nav-item.active {
      background-color: var(--primary-color);
      color: white;
      box-shadow: 0 2px 8px rgba(var(--primary-color-rgb), 0.5);
    }
    
    .overlay {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      top: 0;
      background-color: rgba(var(--bg-color-rgb), 0.95);
      padding: 20px;
      border-radius: 15px 15px 0 0;
      box-shadow: 0 -5px 25px var(--shadow-dark);
      transform: translateY(100%);
      transition: transform 0.4s ease-out, background-color 0.3s ease;
      z-index: 1001;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }
    
    .overlay.show {
      transform: translateY(0);
    }
    
    .overlay-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
      flex-shrink: 0;
    }
    
    .overlay-title {
      color: var(--secondary-color);
      margin: 0;
      font-size: 1.8rem;
    }
    
    .close-overlay {
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.3s ease, transform 0.2s ease;
    }

    .close-overlay:hover {
        color: var(--primary-color);
        transform: rotate(90deg);
    }
    
    .quran-search {
      display: flex;
      margin: 0 10px;
      flex-grow: 1;
      gap: 10px;
    }
    
    .quran-search input {
      flex-grow: 1;
      padding: 10px 15px;
      border-radius: 25px;
      border: 1px solid var(--border-color);
      background-color: var(--card-bg);
      color: var(--text-color);
      font-family: 'Vazirmatn', sans-serif;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .quran-search button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 25px;
      padding: 10px 18px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s;
    }

    .quran-search button:hover {
        background-color: darken(var(--primary-color), 10%);
    }
    
    .quran-controls {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .quran-controls label {
        color: var(--text-color);
        align-self: center;
    }

    .quran-controls select {
      flex: 1;
      min-width: 150px;
      padding: 10px;
      border-radius: 8px;
      background-color: var(--card-bg);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      font-family: 'Vazirmatn', sans-serif;
      appearance: none;
      background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23F0F0F0%22%20d%3D%22M287%2C114.7L154.7%2C247.1c-2.7%2C2.7-6.2%2C4-9.5%2C4s-6.8-1.3-9.5-4L5.4%2C114.7c-3.1-3.1-4-7.6-2.5-11.5c1.5-3.9%2C5.3-6.5%2C9.5-6.5h277.6c4.2%2C0%2C8%2C2.6%2C9.5%2C6.5C291%2C107.1%2C290.1%2C111.6%2C287%2C114.7z%22%2F%3E%3C%2Fsvg%3E');
      background-repeat: no-repeat;
      background-position: left 10px center;
      background-size: 15px;
      padding-left: 35px;
    }
    
    .quran-content {
        flex-grow: 1;
        overflow-y: auto;
        padding-right: 10px;
    }

    .verse-container {
      margin-bottom: 18px;
      padding: 15px;
      border-radius: 10px;
      background-color: var(--card-bg);
      box-shadow: 0 2px 8px var(--shadow-light);
      border: 1px solid var(--border-color);
    }
    
    .verse-arabic {
      font-size: 1.6rem;
      text-align: right;
      line-height: 2.2;
      color: var(--text-color);
      margin-bottom: 10px;
    }
    
    .verse-translation {
      font-size: 1rem;
      text-align: right;
      color: #ccc;
      border-top: 1px dashed var(--border-color);
      padding-top: 10px;
      margin-top: 10px;
      transition: opacity 0.3s ease;
    }

    .verse-english-translation {
      font-size: 1rem;
      text-align: left;
      color: #bbb;
      border-top: 1px dashed var(--border-color);
      padding-top: 10px;
      margin-top: 10px;
      transition: opacity 0.3s ease;
    }
    
    .verse-number {
      display: inline-block;
      width: 30px;
      height: 30px;
      background-color: var(--primary-color);
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 30px;
      font-size: 0.9rem;
      margin-left: 8px;
      flex-shrink: 0;
    }
    
    .loading-spinner, .loading {
      text-align: center;
      padding: 30px;
      color: var(--secondary-color);
    }
    
    .loading-spinner i, .loading i {
      font-size: 2.5rem;
      margin-bottom: 15px;
    }
    
    .month-navigator {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .month-navigator button {
      background: var(--primary-color);
      color: white;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 8px;
      transition: background-color 0.3s ease;
    }

    .month-navigator button:hover {
        background-color: darken(var(--primary-color), 10%);
    }
    
    #currentMonth {
      font-size: 1.3rem;
      color: var(--secondary-color);
      font-weight: 500;
    }
    
    .city-selector {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      flex-shrink: 0;
    }
    
    .city-selector input {
      flex-grow: 1;
      padding: 10px 15px;
      border-radius: 8px;
      background-color: var(--card-bg);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      font-family: 'Vazirmatn', sans-serif;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .city-selector button {
      padding: 10px 20px;
      border-radius: 8px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .city-selector button:hover {
        background-color: darken(var(--primary-color), 10%);
    }
    
    .prayer-times {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px dashed var(--border-color);
      flex-shrink: 0;
    }
    
    .prayer-time {
      background-color: var(--card-bg);
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      border: 1px solid var(--border-color);
      box-shadow: 0 2px 8px var(--shadow-light);
    }
    
    .prayer-time span:first-child {
      display: block;
      font-size: 0.9rem;
      color: var(--secondary-color);
      margin-bottom: 5px;
    }
    
    .prayer-time span:last-child {
      display: block;
      font-size: 1.3rem;
      font-weight: bold;
      color: var(--text-color);
    }
    
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      flex-grow: 1;
      overflow-y: auto;
    }
    
    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      background-color: var(--card-bg);
      font-size: 1rem;
      cursor: pointer;
      border: 1px solid var(--border-color);
      transition: all 0.2s ease;
      box-shadow: 0 1px 4px var(--shadow-light);
    }

    .calendar-day:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px var(--shadow-medium);
    }
    
    .calendar-day.today {
      background-color: var(--primary-color);
      color: white;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(var(--primary-color-rgb), 0.5);
    }
    
    .calendar-day.other-month {
      opacity: 0.6;
      background-color: var(--bg-color);
      color: #999;
    }
    
    .calendar-day-name {
      font-weight: bold;
      margin-bottom: 10px;
      text-align: center;
      color: var(--secondary-color);
      font-size: 1.1rem;
    }
    
    .admin-activator {
      position: fixed;
      top: 20px;
      left: 20px;
      background-color: var(--primary-color);
      color: white;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.3rem;
      cursor: pointer;
      z-index: 1000;
      border: none;
      box-shadow: 0 2px 8px var(--shadow-medium);
      transition: all 0.3s ease;
    }

    .admin-activator:hover {
        transform: scale(1.1);
        background-color: darken(var(--primary-color), 10%);
        box-shadow: 0 5px 15px var(--shadow-dark);
    }
    
    .settings-content {
      padding: 20px;
    }
    
    .surah-header {
      text-align: center;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .verse-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
      flex-shrink: 0;
    }
    
    .verse-actions button {
      flex: 1;
      min-width: 120px;
      padding: 10px;
      font-size: 0.95rem;
      border-radius: 8px;
      background-color: var(--card-bg);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .verse-actions button:hover {
        background-color: var(--primary-color);
        color: white;
        box-shadow: 0 2px 8px rgba(var(--primary-color-rgb), 0.3);
    }

    .haram-stream-container {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      border-radius: 12px;
      background-color: var(--card-bg);
      box-shadow: 0 6px 15px var(--shadow-medium);
      border: 1px solid var(--border-color);
    }

    .haram-stream-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 12px;
      background-color: #000;
    }

    #haramStreamPlaceholder {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background-color: var(--card-bg);
      color: var(--text-color);
      border-radius: 12px;
      font-size: 1.2rem;
      text-align: center;
      padding: 20px;
    }

    #haramStreamPlaceholder i {
        font-size: 3rem;
        margin-bottom: 15px;
        color: var(--secondary-color);
    }
    
    .haram-controls {
      margin-bottom: 20px;
      flex-shrink: 0;
    }

    .haram-controls select {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      background-color: var(--card-bg);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      font-family: 'Vazirmatn', sans-serif;
      appearance: none;
      background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23F0F0F0%22%20d%3D%22M287%2C114.7L154.7%2C247.1c-2.7%2C2.7-6.2%2C4-9.5%2C4s-6.8-1.3-9.5-4L5.4%2C114.7c-3.1-3.1-4-7.6-2.5-11.5c1.5-3.9%2C5.3-6.5%2C9.5-6.5h277.6c4.2%2C0%2C8%2C2.6%2C9.5%2C6.5C291%2C107.1%2C290.1%2C111.6%2C287%2C114.7z%22%2F%3E%3C%2Fsvg%3E');
      background-repeat: no-repeat;
      background-position: left 15px center;
      background-size: 18px;
      padding-left: 45px;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    }

    .haram-controls select:focus {
        outline: none;
        border-color: var(--secondary-color);
        box-shadow: 0 0 0 3px rgba(var(--secondary-color-rgb), 0.3);
    }

    /* انیمیشن شیشه‌ای */
    .glass-loading {
      position: relative;
      overflow: hidden;
    }

    .glass-loading::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      animation: glassLoading 1.5s infinite;
    }

    @keyframes glassLoading {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    /* Utility classes for colors */
    .primary-text { color: var(--primary-color); }
    .secondary-text { color: var(--secondary-color); }
    
    /* دسته‌بندی گالری */
    .gallery-category {
      margin-bottom: 30px;
    }
    
    .gallery-category-title {
      color: var(--secondary-color);
      font-size: 1.8rem;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--secondary-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .gallery-category-buttons {
      display: flex;
      gap: 10px;
    }
    
    .gallery-category-btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    
    .gallery-category-btn.active {
      background-color: var(--secondary-color);
      color: var(--bg-color);
    }
    
    /* استایل‌های جدید برای ویدیوها */
    .video-container {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    
    .video-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }

    /* START: Styles for new calendar component */
    .calendar-container {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background-color: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 5px 20px var(--shadow-medium);
      border: 1px solid var(--border-color);
    }
    .overlay .calendar-container {
      box-shadow: none;
      border: none;
      padding: 0;
      background-color: transparent;
    }
    
    .calendar-container h2 {
      color: var(--secondary-color);
      font-size: 1.8rem;
      text-align: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--secondary-color);
      position: relative;
    }
    
    .calendar-container h2::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 2px;
      background-color: var(--primary-color);
    }
    
    .calendar-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .calendar-card {
      background-color: var(--section-bg);
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 10px var(--shadow-light);
      border: 1px solid var(--border-color);
      text-align: center;
      transition: transform 0.3s ease;
    }
    
    .calendar-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 15px var(--shadow-medium);
    }
    
    .calendar-card h3 { /* Changed from h2 to h3 */
      color: var(--secondary-color);
      font-size: 1.3rem;
      margin: 0 0 15px;
    }
    
    .calendar-date {
      font-size: 1.5rem;
      font-weight: 700;
      margin: 10px 0;
      color: var(--text-color);
    }
    
    .calendar-weekday {
      font-size: 1rem;
      color: var(--text-color);
      opacity: 0.8;
    }
    
    .converter-container {
      background-color: var(--section-bg);
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 4px 10px var(--shadow-light);
      border: 1px solid var(--border-color);
    }
    
    .converter-container h3 { /* Changed from h2 to h3 */
      color: var(--secondary-color);
      font-size: 1.3rem;
      margin: 0 0 15px;
      text-align: center;
    }
    
    .converter-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    .converter-input {
      flex: 1;
      min-width: 200px;
    }
    
    input[type="date"] {
      width: 100%;
      padding: 12px 15px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background-color: var(--card-bg);
      color: var(--text-color);
      font-family: 'Vazirmatn', sans-serif;
      box-shadow: inset 0 1px 3px var(--shadow-light);
    }
    
    .converter-row button {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      background-color: var(--primary-color);
      color: white;
      font-family: 'Vazirmatn', sans-serif;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .converter-row button:hover {
      background-color: #6b0000;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
    }
    
    .converter-results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .converter-result {
      background-color: var(--card-bg);
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      border: 1px solid var(--border-color);
    }
    
    .converter-result-label {
      font-size: 0.9rem;
      color: var(--secondary-color);
      margin-bottom: 8px;
    }
    
    .converter-result-value {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text-color);
    }
    
    .loader {
      font-size: 0.9rem;
      color: var(--secondary-color);
      display: none;
      text-align: center;
      margin: 10px 0;
    }
    
    .error {
      color: #ff6b6b;
      font-size: 0.9rem;
      margin-top: 10px;
      text-align: center;
      padding: 30px;
      background: #5c0000;
      border-radius: 10px;
    }
    /* END: Styles for new calendar component */
    
    /* START: Styles for new feed component */
    .post-list {
        display: grid;
        gap: 25px;
    }

    .post-item {
        background: var(--card-bg);
        padding: 25px;
        border-radius: 12px;
        border-right: 4px solid var(--primary-color);
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .post-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }

    .post-title {
        color: var(--secondary-color);
        margin: 0 0 15px 0;
        font-size: 1.4rem;
    }

    .post-excerpt {
        color: var(--text-color);
        margin-bottom: 15px;
        opacity: 0.9;
    }

    .post-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px dashed var(--border-color);
    }

    .post-date {
        color: #aaa;
        font-size: 0.9rem;
    }

    .category-badge {
        background: var(--primary-color);
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        margin-left: 10px;
    }
    /* END: Styles for new feed component */


    /* Responsive adjustments */
    @media (max-width: 768px) {
      header h1 {
        font-size: 2.2rem;
      }
      
      nav a {
        font-size: 1rem;
        margin: 5px 8px;
        padding: 6px 10px;
        gap: 5px;
      }

      nav a i {
          font-size: 1em;
      }
      
      .theme-toggle-nav {
        font-size: 1.2rem;
        margin: 5px 8px;
        padding: 6px;
      }

      section {
        padding: 30px 15px;
        margin: 20px auto;
      }
      
      h2 {
        font-size: 1.8rem;
        margin-bottom: 20px;
      }

      h3 {
          font-size: 1.3rem;
      }
      
      .gallery {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .media-frame {
        height: 300px;
      }
      
      .bottom-nav-item {
        font-size: 0.75rem;
        padding: 6px 5px;
        min-width: 50px;
      }
      
      .bottom-nav-item i {
        font-size: 1.3rem;
        margin-bottom: 3px;
      }
      
      .overlay-title {
        font-size: 1.5rem;
      }

      .quran-search {
          flex-direction: column;
          gap: 10px;
      }

      .quran-search input, .quran-search button {
          width: 100%;
      }
      
      .quran-controls {
        flex-direction: column;
        gap: 10px;
      }
      
      .verse-arabic {
        font-size: 1.4rem;
      }

      .verse-translation, .verse-english-translation {
          font-size: 0.9rem;
      }
      
      .verse-actions {
        flex-direction: column;
        gap: 8px;
      }

      .verse-actions button {
          font-size: 0.9rem;
          padding: 8px;
      }

      .month-navigator {
          flex-wrap: wrap;
          font-size: 1.1rem;
      }

      .prayer-times {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
      }

      .city-selector {
          flex-direction: column;
          gap: 10px;
      }

      form {
          padding: 20px;
          gap: 15px;
      }

      .social-link {
          font-size: 0.9rem;
          padding: 10px 15px;
      }

      .post-meta {
          flex-direction: column;
          gap: 10px;
          align-items: flex-start;
      }

      .converter-row {
        flex-direction: column;
      }
      .converter-input, .converter-row button {
        width: 100%;
        justify-content: center;
      }
    }

    @media (max-width: 480px) {
        header h1 {
            font-size: 1.8rem;
        }
        header p {
            font-size: 1rem;
        }
        nav {
            padding: 5px 0;
        }
        nav a {
            margin: 3px 5px;
            font-size: 0.9rem;
        }
        .theme-toggle-nav {
            font-size: 1rem;
        }
        section {
            padding: 20px 10px;
        }
        h2 {
            font-size: 1.6rem;
        }
        .bottom-nav-item span {
            display: block;
        }
        .bottom-nav-item {
            font-size: 0.7rem;
        }
        .overlay-title {
            font-size: 1.3rem;
        }
        .close-overlay {
            font-size: 1.3rem;
        }
        .quran-controls {
            flex-direction: column;
        }
        .quran-controls select {
            min-width: unset;
        }
        .prayer-time span:last-child {
            font-size: 1.1rem;
        }
        .calendar-day {
            font-size: 0.85rem;
        }
        .calendar-cards, .converter-results {
            grid-template-columns: 1fr;
        }
    }

    /* START: Light Mode Readability Fixes */
    body.light-mode nav a,
    body.light-mode .theme-toggle-nav {
      color: #333333; /* Dark text for light nav background */
    }
    
    body.light-mode nav a:hover {
      color: var(--primary-color);
      background-color: rgba(0, 0, 0, 0.08);
    }

    body.light-mode .theme-toggle-nav:hover {
      color: var(--primary-color);
      background-color: rgba(0, 0, 0, 0.08);
    }

    body.light-mode .bottom-nav-item {
        color: #555555; /* Darker text for bottom nav */
    }

    body.light-mode .bottom-nav-item:hover {
        background-color: rgba(0, 0, 0, 0.08);
        color: var(--primary-color);
    }
    
    body.light-mode .bottom-nav-item.active {
        color: white; /* Stays white on colored background */
    }

    body.light-mode footer {
      color: #555555; /* Darker text for footer */
    }

    body.light-mode .verse-translation {
      color: #555555; /* Darker gray for Persian translation */
    }

    body.light-mode .verse-english-translation {
      color: #666666; /* Darker gray for English translation */
    }

    body.light-mode .calendar-day.other-month {
      background-color: #e9e9e9;
      color: #666666; /* Darker text for non-current month days */
      opacity: 0.8;
    }
    
    body.light-mode .post-header small {
        color: #777777; /* Darker gray for post date */
    }
    
    body.light-mode .quran-controls select,
    body.light-mode .haram-controls select,
    body.light-mode #city, 
    body.light-mode #method {
      background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23333333%22%20d%3D%22M287%2C114.7L154.7%2C247.1c-2.7%2C2.7-6.2%2C4-9.5%2C4s-6.8-1.3-9.5-4L5.4%2C114.7c-3.1-3.1-4-7.6-2.5-11.5c1.5-3.9%2C5.3-6.5%2C9.5-6.5h277.6c4.2%2C0%2C8%2C2.6%2C9.5%2C6.5C291%2C107.1%2C290.1%2C111.6%2C287%2C114.7z%22%2F%3E%3C%2Fsvg%3E');
    }
    
    body.light-mode #haramOnlineOverlay p {
      color: #555555; /* Darker text for the helper paragraph in Haram Online */
    }
    /* END: Light Mode Readability Fixes */
  </style>
</head>
<body>

<header>
  <h1>حسینیه فدائیان ائمه اطهار (ع)</h1>
  <p>تأسیس ۱۳۵۰ - 
 موقوفه مرحوم حاج حسین عباسی شایسته (متوفی بهمن ۱۳۹۶)</p>
  <div class="search-box">
    <input type="text" id="siteSearchInput" placeholder="جستجو در سایت..." autocomplete="off">
    <button type="submit" onclick="performSearch()"><i class="fas fa-search"></i></button>
    <div class="search-history" id="searchHistory">
      <div class="search-history-header">
        <span>تاریخچه جستجو</span>
        <button class="clear-history" onclick="clearSearchHistory()">پاک کردن تاریخچه</button>
      </div>
      <div id="historyItems"></div>
    </div>
  </div>
</header>

<nav>
  <a href="#about"><i class="fas fa-info-circle"></i> درباره ما</a>
  <a href="#programs"><i class="fas fa-calendar-alt"></i> برنامه‌ها</a>
  <a href="#madahi"><i class="fas fa-music"></i> مداحی</a>
  <a href="#mowludi"><i class="fas fa-microphone-alt"></i> مولودی</a>
  <a href="#gallery"><i class="fas fa-images"></i> گالری تصاویر و ویدیوها</a>
  <a href="#contact"><i class="fas fa-envelope"></i> تماس با ما</a>
  <button class="theme-toggle-nav" onclick="toggleTheme()">
    <i class="fas fa-moon"></i>
    <i class="fas fa-sun"></i>
  </button>
</nav>

<section id="about">
  <h2>درباره حسینیه</h2>
  <p>
    حسینیه فدائیان ائمه اطهار مکانی برای برگزاری مراسم‌های مذهبی، عزاداری، سخنرانی‌های دینی، جلسات قرائت دعا و جلسات معرفتی برای عاشقان اهل بیت (ع) می‌باشد. این حسینیه با سابقه‌ای درخشان از سال ۱۳۵۰ در برگزاری مراسم‌های مذهبی، میزبان دلسوختگان و محبین اهل بیت علیهم‌السلام است.
  </p>
  <p>
    این مکان به همت و وقف مرحوم حاج حسین عباسی شایسته (متوفی بهمن ۱۳۹۶) تأسیس شده و همچنان به فعالیت‌های مذهبی خود ادامه می‌دهد.
  </p>
  <p>
    برنامه‌های متنوعی از جمله جلسات تفسیر قرآن، مراسم عزاداری ماه‌های محرم و صفر، جلسات دعای کمیل، توسل و ندبه در این مکان برگزار می‌شود.
  </p>
</section>

<section id="programs">
  <h2>برنامه‌های هفتگی</h2>
  <div class="program-schedule">
    <div class="program-day">
      <h3>یکشنبه‌ها</h3>
      <p>از اذان مغرب:</p>
      <p>اقامه نماز جماعت: حاج آقا دشتی</p>
      <p>قرائت زیارت عاشورا: آقای مهدی اسدی</p>
      <p>قرائت قرآن کریم: حاج آقا مهدی دشتی</p>
      <p>مداحی: آقای هاشم بشیری</p>
    </div>
    <div class="program-day">
      <h3>پنجشنبه‌ها</h3>
      <p>مکان: خیابان کارگر جنوبی، بین میدان پاستور و خیابان آذربایجان نبش کوچه روشن پلاک ۱ طبقه دوم</p>
      <p><span class="highlight">زنگ زده شود</span> از ساعت ۲۱ الی ۱۲ بامداد</p>
    </div>
  </div>
</section>

<section id="madahi">
  <h2>مداحی‌ها</h2>
  <p>مجموعه‌ای از بهترین مداحی‌های جدید:</p>
  
  <div class="media-container" id="madahiContainer">
    <div class="media-header">
      <h3 class="media-title">آخرین مداحی‌ها</h3>
      <div class="media-controls">
        <i class="fas fa-headphones"></i>
      </div>
    </div>
    <iframe src="https://kashoob.com/audios/type/madahi" 
            class="media-frame"
            sandbox="allow-same-origin allow-scripts allow-popups"
            loading="lazy"
            referrerpolicy="no-referrer"
            onload="document.getElementById('madahiContainer').classList.remove('glass-loading')">
    </iframe>
  </div>
</section>

<section id="mowludi">
  <h2>مولودی‌ها</h2>
  <p>مجموعه‌ای از مولودی‌های جدید:</p>
  
  <div class="media-container" id="mowludiContainer">
    <div class="media-header">
      <h3 class="media-title">آخرین مولودی‌ها</h3>
      <div class="media-controls">
        <i class="fas fa-music"></i>
      </div>
    </div>
    <iframe src="https://kashoob.com/audios/sabk" 
            class="media-frame"
            sandbox="allow-same-origin allow-scripts allow-popups"
            loading="lazy"
            referrerpolicy="no-referrer"
            onload="document.getElementById('mowludiContainer').classList.remove('glass-loading')">
    </iframe>
  </div>
</section>

<section id="gallery">
  <h2>گالری تصاویر و ویدیوهای منتخب حسینیه</h2>
  
  <div class="gallery-category">
    <div class="gallery-category-buttons">
      <button class="gallery-category-btn active" onclick="filterGallery('all')">همه</button>
      <button class="gallery-category-btn" onclick="filterGallery('madahi')">مداحی‌ها</button>
      <button class="gallery-category-btn" onclick="filterGallery('mowludi')">مولودی‌ها</button>
      <button class="gallery-category-btn" onclick="filterGallery('quran')">قرائت قرآن کریم</button>
      <button class="gallery-category-btn" onclick="filterGallery('other')">سایر</button>
    </div>
    <div class="gallery">
      <div class="gallery-item" data-category="madahi" data-date="1404/06/01">
        <div class="video-container">
          <iframe src="https://www.aparat.com/video/video/embed/videohash/abc123/vt/frame?titleShow=true&muted=true&autoplay=true&recom=self" 
                  allow="autoplay" 
                  allowFullScreen="true" 
                  webkitallowfullscreen="true" 
                  mozallowfullscreen="true"></iframe>
        </div>
        <div class="gallery-caption">
          <h4>مداحی شب اول محرم</h4>
          <p>مداحی استاد بشیری در شب اول محرم ۱۴۰۴</p>
          <div class="date">۱۴۰۴/۰۶/۰۱</div>
        </div>
      </div>
      
      <div class="gallery-item" data-category="madahi" data-date="1404/06/10">
        <div class="video-container">
          <iframe src="https://www.aparat.com/video/video/embed/videohash/def456/vt/frame?titleShow=true&muted=true&autoplay=true&recom=self" 
                  allow="autoplay" 
                  allowFullScreen="true" 
                  webkitallowfullscreen="true" 
                  mozallowfullscreen="true"></iframe>
        </div>
        <div class="gallery-caption">
          <h4>مداحی عاشورا</h4>
          <p>مداحی استاد بشیری در روز عاشورا</p>
          <div class="date">۱۴۰۴/۰۶/۱۰</div>
        </div>
      </div>
      
      <div class="gallery-item" data-category="mowludi" data-date="1404/05/05">
        <div class="video-container">
          <iframe src="https://www.aparat.com/video/video/embed/videohash/ghi789/vt/frame?titleShow=true&muted=true&autoplay=true&recom=self" 
                  allow="autoplay" 
                  allowFullScreen="true" 
                  webkitallowfullscreen="true" 
                  mozallowfullscreen="true"></iframe>
        </div>
        <div class="gallery-caption">
          <h4>مولودی میلاد امام رضا (ع)</h4>
          <p>مولودی ویژه میلاد امام رضا (ع) با صدای استاد رضایی</p>
          <div class="date">۱۴۰۴/۰۵/۰۵</div>
        </div>
      </div>
      
      <div class="gallery-item" data-category="mowludi" data-date="1404/02/15">
        <div class="video-container">
          <iframe src="https://www.aparat.com/video/video/embed/videohash/jkl012/vt/frame?titleShow=true&muted=true&autoplay=true&recom=self" 
                  allow="autoplay" 
                  allowFullScreen="true" 
                  webkitallowfullscreen="true" 
                  mozallowfullscreen="true"></iframe>
        </div>
        <div class="gallery-caption">
          <h4>مولودی ولادت امام زمان (عج)</h4>
          <p>مولودی ویژه نیمه شعبان با صدای استاد محمدی</p>
          <div class="date">۱۴۰۴/۰۲/۱۵</div>
        </div>
      </div>
      
      <div class="gallery-item" data-category="quran" data-date="1404/03/11">
        <div class="video-container">
          <div id="80258320637"><script type="text/JavaScript" src="https://www.aparat.com/embed/ezjx1h2?data[rnddiv]=80258320637&data[responsive]=yes&muted=true&titleShow=true&recom=self"></script></div>
        </div>
        <div class="gallery-caption">
          <h4>قرائت قرآن توسط آقای خوانساری</h4>
          <p>قرائت دل‌نشین قرآن کریم توسط استاد خوانساری در حسینیه ائمه اطهار</p>
          <div class="date">۱۴۰۴/۰۳/۱۱</div>
        </div>
      </div>
      
      <div class="gallery-item" data-category="mowludi" data-date="1404/02/14">
        <div class="video-container">
          <div id="47862427599"><script type="text/JavaScript" src="https://www.aparat.com/embed/lhz9416?data[rnddiv]=47862427599&data[responsive]=yes&muted=true&titleShow=true&recom=self"></script></div>
        </div>
        <div class="gallery-caption">
          <h4>مولودی آقای هاشم بشیری به مناسبت دهه کرامت</h4>
          <p>مولودی‌خوانی آقای هاشم بشیری در حسینیه فدائیان ائمه اطهار (ع) به مناسبت فرخنده دهه کرامت.</p>
          <div class="date">۱۴۰۴/۰۲/۱۴</div>
        </div>
      </div>
      
      <div class="gallery-item" data-category="quran" data-date="1404/02/14">
        <div class="video-container">
          <div id="48348150082"><script type="text/JavaScript" src="https://www.aparat.com/embed/vgy41r3?data[rnddiv]=48348150082&data[responsive]=yes&muted=true&titleShow=true&recom=self"></script></div>
        </div>
        <div class="gallery-caption">
          <h4>قرائت قرآن توسط آقای حسین بیات</h4>
          <p>قرائت قرآن کریم را به صدای قاری ممتاز بین المللی، حسین بیات، تقدیم می‌نماییم.</p>
          <div class="date">۱۴۰۴/۰۲/۱۴</div>
        </div>
      </div>
      
      <div class="gallery-item" data-category="madahi" data-date="1404/05/05">
        <div class="video-container">
          <div id="40700826077"><script type="text/JavaScript" src="https://www.aparat.com/embed/dug68ed?data[rnddiv]=40700826077&data[responsive]=yes&muted=true&titleShow=true&recom=self"></script></div>
        </div>
        <div class="gallery-caption">
          <h4>مداحی حاج آقای کریمی - شهادت حضرت رقیه (س)</h4>
          <p>مداحی زیبای حاج آقای کریمی به مناسبت شهادت حضرت رقیه (س)</p>
          <div class="date">۱۴۰۴/۰۵/۰۵</div>
        </div>
      </div>
      
      <div class="gallery-item" data-category="quran" data-date="1404/05/05">
        <div class="video-container">
          <div id="45637197764"><script type="text/JavaScript" src="https://www.aparat.com/embed/rqvgo2n?data[rnddiv]=45637197764&data[responsive]=yes&muted=true&titleShow=true&recom=self"></script></div>
        </div>
        <div class="gallery-caption">
          <h4>قرائت قرآن توسط آقای داوری در حسینیه ائمه اطهار</h4>
          <p>محفل نورانی انس با قرآن کریم با حضور قاری ممتاز، جناب آقای داوری، در حسینیه ائمه اطهار (ع)</p>
          <div class="date">۱۴۰۴/۰۵/۰۵</div>
        </div>
      </div>
      
      <div class="gallery-item" data-category="other" data-date="1404/05/05">
        <div class="video-container">
          <div id="15335365572"><script type="text/JavaScript" src="https://www.aparat.com/embed/desgcj7?data[rnddiv]=15335365572&data[responsive]=yes&muted=true&titleShow=true&recom=self"></script></div>
        </div>
        <div class="gallery-caption">
          <h4>حکایت زیارت عاشورا | آقای کلاهی - حسینیه ائمه اطهار (ع)</h4>
          <p>شما را دعوت می‌کنیم به شنیدن حکایتی واقعی از انسانی مؤمن که هر صبح با عشق و اخلاص، زیارت عاشورا می‌خواند.</p>
          <div class="date">۱۴۰۴/۰۵/۰۵</div>
        </div>
      </div>
      
      <div class="gallery-item" data-category="other" data-date="1404/05/12">
        <div class="video-container">
          <div id="24185882678"><script type="text/JavaScript" src="https://www.aparat.com/embed/pvvh1hj?data[rnddiv]=24185882678&data[responsive]=yes&muted=true&titleShow=true&recom=self"></script></div>
        </div>
        <div class="gallery-caption">
          <h4>حکایت نجات عروس و داماد | آقای کلاهی - حسینیه ائمه اطهار</h4>
          <p>امامی در شب عروسی، حضور عزرائیل را می‌بیند که آمده جان عروس و داماد را بگیرد...</p>
          <div class="date">۱۴۰۴/۰۵/۱۲</div>
        </div>
      </div>
      
      <div class="gallery-item" data-category="other" data-date="1404/06/01">
        <img src="https://via.placeholder.com/300x220/800000/FFFFFF?text=Image+1" alt="مراسم عزاداری محرم">
        <div class="gallery-caption">
          <h4>مراسم عزاداری محرم</h4>
          <p>مراسم شب اول محرم ۱۴۰۴ در حسینیه فدائیان ائمه اطهار</p>
          <div class="date">۱۴۰۴/۰۶/۰۱</div>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="contact">
  <h2>تماس با ما</h2>
  <p><i class="fas fa-map-marker-alt primary-text"></i> آدرس: خیابان کارگر جنوبی، بین میدان پاستور و خیابان آذربایجان نبش کوچه روشن</p>
  <div class="navigation-links" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
    <a href="https://nshn.ir/8asbvg7j2xO5N-" target="_blank" class="social-link" style="background-color: #5cb85c;">
      <i class="fas fa-directions"></i> مسیریابی با نشان
    </a>
    <a href="https://balad.ir/p/3S1Gx4hJNsNOlw" target="_blank" class="social-link" style="background-color: #007bff;">
      <i class="fas fa-directions"></i> مسیریابی با بلد
    </a>
  </div>

  <h3><i class="fas fa-share-alt primary-text"></i> شبکه‌های اجتماعی</h3>
  <div class="social-links">
    <a href="https://t.me/Heiat_imams_athar" target="_blank" class="social-link" style="background-color: #26A5E4;">
      <i class="fab fa-telegram-plane"></i> تلگرام
    </a>
    <a href="https://splus.ir/heiat_imams_athar" target="_blank" class="social-link" style="background-color: #5d4393;">
        <i class="fas fa-comment-alt"></i> سروش پلاس
    </a>
    <a href="https://eitaa.com/Heiat_imams_athar" target="_blank" class="social-link" style="background-color: #F87D33;">
      <i class="fas fa-paper-plane"></i> ایتا
    </a>
    <a href="https://instagram.com/Heiat_imams_athar" target="_blank" class="social-link" style="background-color: #E4405F;">
      <i class="fab fa-instagram"></i> اینستاگرام
    </a>
    <a href="https://aparat.com/Heiat_imams_athar" target="_blank" class="social-link" style="background-color: #ED1C24;">
      <i class="fab fa-youtube"></i> آپارات
    </a>
    <a href="https://whatsapp.com/channel/0029Vb5eNUQDJ6H26kPvNK1W" target="_blank" class="social-link" style="background-color: #25D366;">
      <i class="fab fa-whatsapp"></i> واتساپ
    </a>
    <a href="https://ble.ir/Heiat_imams_athar" target="_blank" class="social-link" style="background-color: #3150A6;">
      <i class="fas fa-bell"></i> بله
    </a>
  </div>

  <h3><i class="fas fa-comments primary-text"></i> ارتباط مستقیم</h3>
  <p>جهت ارتباط با ما در یکی از پیام‌رسان های زیر به ما پیام دهید:</p>
  <div class="social-links">
    <a href="https://t.me/pr_heiat" target="_blank" class="social-link" style="background-color: #26A5E4;">
      <i class="fab fa-telegram-plane"></i> تلگرام
    </a>
    <a href="https://eitaa.ir/pr_heiat" target="_blank" class="social-link" style="background-color: #F87D33;">
      <i class="fas fa-paper-plane"></i> ایتا
    </a>
    <a href="https://ble.ir/pr_heiat" target="_blank" class="social-link" style="background-color: #3150A6;">
      <i class="fas fa-bell"></i> بله
    </a>
  </div>
</section>

<section id="searchResultsSection" style="display: none;">
  <h2>نتایج جستجو</h2>
  <div class="search-results" id="searchResultsContainer">
    <p id="noResultsMessage" style="text-align: center; color: var(--text-color);">لطفاً عبارت مورد نظر خود را جستجو کنید.</p>
  </div>
  <div class="search-navigation" id="searchNavigation" style="display: none;">
    <button id="prevResultBtn" class="search-nav-btn" disabled><i class="fas fa-arrow-right"></i> نتیجه قبلی</button>
    <span id="resultCounter" style="align-self: center;"></span>
    <button id="nextResultBtn" class="search-nav-btn" disabled>نتیجه بعدی <i class="fas fa-arrow-left"></i></button>
  </div>
</section>

<footer>
  <p>&copy; ۱۴۰۴ حسینیه فدائیان ائمه اطهار | تأسیس ۱۳۵۰ | تمامی حقوق محفوظ است</p>
  <p>طراحی و توسعه مهیار اسدی</p>
</footer>

<button class="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
  <i class="fas fa-arrow-up"></i>
</button>

<div class="bottom-nav" id="bottomNav">
  <a href="#calendar" class="bottom-nav-item" onclick="showCalendar()">
    <i class="fas fa-calendar"></i>
    <span>تقویم</span>
  </a>
  <a href="#" class="bottom-nav-item" onclick="scrollToTop()">
    <i class="fas fa-home"></i>
    <span>خانه</span>
  </a>
  <a href="#quran" class="bottom-nav-item" onclick="showQuranSection()">
    <i class="fas fa-quran"></i>
    <span>قرآن</span>
  </a>
  <a href="#feed" class="bottom-nav-item" onclick="toggleFeed()">
    <i class="fas fa-newspaper"></i>
    <span>اطلاع‌رسانی</span>
  </a>
  <a href="#haram" class="bottom-nav-item" onclick="showHaramOnlineSection()">
    <i class="fas fa-mosque"></i>
    <span>حرم آنلاین</span>
  </a>
</div>

<div class="overlay" id="quranOverlay">
  <div class="overlay-header">
    <h3 class="overlay-title">قرآن کریم</h3>
    <div class="quran-search">
      <input type="text" id="quranSearch" placeholder="جستجوی متن، یا 'بقره ۵' یا '2:5'">
      <button onclick="searchInQuran()"><i class="fas fa-search"></i></button>
    </div>
    <button class="close-overlay" onclick="toggleOverlay('quranOverlay')">
      <i class="fas fa-times"></i>
    </button>
  </div>
  
  <div class="quran-controls">
    <label for="surahSelectInner">انتخاب سوره:</label>
    <select id="surahSelectInner" onchange="loadSurah(this.value)">
      <option value="">-- انتخاب سوره --</option>
    </select>
    <label for="juzSelect">انتخاب جزء:</label>
    <select id="juzSelect" onchange="loadJuz(this.value)">
      <option value="">-- انتخاب جزء --</option>
    </select>
  </div>
  
  <div class="quran-content" id="quranContent">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p>در حال بارگذاری...</p>
    </div>
  </div>
  
  <div class="verse-actions">
    <button onclick="toggleTranslation('persian')"><i class="fas fa-language"></i> نمایش/عدم نمایش ترجمه فارسی</button>
    <button onclick="toggleTranslation('english')"><i class="fas fa-language"></i> نمایش/عدم نمایش ترجمه انگلیسی</button>
    <button onclick="toggleAudio()"><i class="fas fa-volume-up"></i> پخش صوتی</button>
    <button onclick="bookmarkVerse()"><i class="fas fa-bookmark"></i> ذخیره</button>
  </div>
</div>

<div class="overlay" id="calendarOverlay">
  <div class="overlay-header">
    <h3 class="overlay-title">تقویم و اوقات شرعی</h3>
    <button class="close-overlay" onclick="toggleOverlay('calendarOverlay')">
      <i class="fas fa-times"></i>
    </button>
  </div>
  
  <div class="calendar-container">
    <h2><i class="fas fa-calendar-alt"></i> تقویم شمسی، قمری و میلادی</h2>
    <div class="calendar-cards" id="todayCards">
      <div class="calendar-card">
        <h3><i class="fas fa-sun"></i> شمسی (جلالی)</h3>
        <div class="calendar-date" id="faToday">—</div>
        <div class="calendar-weekday" id="faWeekday">—</div>
      </div>
      <div class="calendar-card">
        <h3><i class="fas fa-moon"></i> قمری (هجری)</h3>
        <div class="calendar-date" id="hiToday">—</div>
        <div class="calendar-weekday" id="hiWeekday">—</div>
        <div class="loader" id="hiLoading"><i class="fas fa-spinner fa-spin"></i> در حال دریافت تاریخ قمری...</div>
        <div class="error" id="hiError"></div>
      </div>
      <div class="calendar-card">
        <h3><i class="fas fa-globe"></i> میلادی (Gregorian)</h3>
        <div class="calendar-date" id="enToday">—</div>
        <div class="calendar-weekday" id="enWeekday">—</div>
      </div>
    </div>
    <div class="converter-container">
      <h3><i class="fas fa-exchange-alt"></i> مبدل تاریخ</h3>
      <div class="converter-row">
        <div class="converter-input">
          <input id="pick" type="date" />
        </div>
        <button id="convertBtn"><i class="fas fa-sync-alt"></i> تبدیل تاریخ</button>
        <div class="loader" id="cvLoading"><i class="fas fa-spinner fa-spin"></i> در حال دریافت...</div>
      </div>
      <div class="converter-results">
        <div class="converter-result">
          <div class="converter-result-label">خروجی شمسی</div>
          <div class="converter-result-value" id="cvFa">—</div>
        </div>
        <div class="converter-result">
          <div class="converter-result-label">خروجی قمری</div>
          <div class="converter-result-value" id="cvHi">—</div>
          <div class="error" id="cvErr"></div>
        </div>
        <div class="converter-result">
          <div class="converter-result-label">نمایش میلادی</div>
          <div class="converter-result-value" id="cvEn">—</div>
        </div>
      </div>
    </div>
  </div>
  <div class="container" style="padding-top: 20px;">
    <div class="prayer-card">
      <h2 style="font-size: 2rem;"><i class="fas fa-mosque"></i> اوقات شرعی</h2>
      <p style="text-align: center; opacity: 0.9;">اوقات شرعی شهرهای ایران بر اساس تقویم رسمی کشور</p>
      
      <div class="controls">
        <select id="city">
          <option value="">-- انتخاب شهر --</option>
        </select>
        
        <select id="method">
          <option value="7" selected>روش محاسبه: تهران</option>
          <option value="1">مصر</option>
          <option value="2">کراچی</option>
          <option value="3">جامعه اسلامی</option>
          <option value="4">ام القری</option>
          <option value="8">کویت</option>
          <option value="9">قطر</option>
          <option value="20">جعفری</option>
        </select>
        
        <button onclick="getTimings()">
          <i class="fas fa-search"></i> نمایش اوقات
        </button>
      </div>
      
      <div id="loading" class="loading" style="display: none;">
        <i class="fas fa-spinner"></i>
        <p>در حال دریافت اطلاعات...</p>
      </div>
      
      <div id="error" class="error" style="display: none;"></div>
      
      <div id="result" style="display: none;">
        <h3 id="cityTitle"></h3>
        
        <div class="prayer-times" id="prayerTimesContainer">
          </div>
        
        <div class="dates">
          <div class="date-box">
            <div class="date-title">تاریخ امروز</div>
            <div class="date-value" id="shamsiDate"></div>
          </div>
          <div class="date-box">
            <div class="date-title">هجری قمری</div>
            <div class="date-value" id="hijriDate"></div>
          </div>
          <div class="date-box">
            <div class="date-title">میلادی</div>
            <div class="date-value" id="gregorianDate"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="overlay" id="haramOnlineOverlay">
  <div class="overlay-header">
    <h3 class="overlay-title">حرم آنلاین</h3>
    <button class="close-overlay" onclick="toggleOverlay('haramOnlineOverlay')">
      <i class="fas fa-times"></i>
    </button>
  </div>
  
  <div class="haram-controls">
    <select id="haramSelect" onchange="loadHaramStream(this.value)">
      <option value="">-- انتخاب حرم/مکان --</option>
      <option value="https://heyatonline.ir/hm/karbala/">کربلا (بین‌الحرمین)</option>
      <option value="https://heyatonline.ir/hm/1/">حرم امام رضا (ع) - صحن انقلاب</option>
      <option value="https://heyatonline.ir/hm/2/">حرم امام رضا (ع) - صحن آزادی</option>
      <option value="https://heyatonline.ir/hm/3/">حرم امام رضا (ع) - صحن جامع رضوی</option>
      <option value="https://heyatonline.ir/hm/4/">حرم حضرت معصومه (س)</option>
      <option value="https://heyatonline.ir/hm/5/">حرم امام حسین (ع) - گنبد</option>
      <option value="https://heyatonline.ir/hm/15/">حرم امام حسین (ع) - روضه</option>
      <option value="https://heyatonline.ir/hm/6/">حرم حضرت عباس (ع)</option>
      <option value="https://heyatonline.ir/hm/7/">مسجد کوفه</option>
      <option value="https://heyatonline.ir/hm/8/">مسجد سهله</option>
      <option value="https://heyatonline.ir/hm/9/">عتبات عالیات - کاظمین</option>
    </select>
  </div>

  <div class="haram-stream-container glass-loading">
    <iframe id="haramStreamIframe" 
            src="" 
            frameborder="0" 
            allow="autoplay; encrypted-media" 
            allowfullscreen 
            loading="lazy"
            referrerpolicy="no-referrer">
    </iframe>
    <div id="haramStreamPlaceholder">
        <i class="fas fa-mosque"></i>
        <p>لطفاً یک حرم را انتخاب کنید تا پخش زنده نمایش داده شود.</p>
    </div>
  </div>
  <p style="text-align: center; font-size: 0.8rem; color: #aaa; margin-top: 15px;">
    پخش زنده حرم و اماکن متبرکه. در صورت عدم نمایش، لطفاً به اینترنت متصل باشید و فیلترشکن را خاموش کنید.
  </p>
</div>

<div class="overlay" id="feedOverlay">
  <div class="overlay-header">
    <h3 class="overlay-title">اطلاع‌رسانی و اخبار</h3>
    <button class="close-overlay" onclick="toggleOverlay('feedOverlay')">
      <i class="fas fa-times"></i>
    </button>
  </div>
  
  <div class="feed-container" id="feedContainer" style="flex-grow: 1; overflow-y: auto; padding: 10px;">
    <div id="loading" class="loading">
        <i class="fas fa-spinner fa-spin"></i>
        <p>در حال بارگذاری پست‌ها...</p>
    </div>
    <div id="error" class="error" style="display: none;"></div>
    <div id="postList" class="post-list" style="display: none;"></div>
  </div>
</div>
<script>
  // START: JS for new calendar component
  const pad = n => String(n).padStart(2, '0');

  function toPersianNumbers(num) {
    const persianDigits = '۰۱۲۳۴۵۶۷۸۹';
    return String(num).replace(/[0-9]/g, function(d) {
      return persianDigits[parseInt(d)];
    });
  }

  function formatGregorian(date, locale='en-GB') {
    const options = {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    };
    
    if (locale === 'fa-IR') {
      return new Intl.DateTimeFormat(locale, options).format(date);
    } else {
      return date.toLocaleDateString(locale, options);
    }
  }

  function toJalaliString(date) {
    const gy = date.getFullYear();
    const gm = date.getMonth() + 1;
    const gd = date.getDate();
    const j = window.jalaali.toJalaali(gy, gm, gd);
    const months = ['فروردین','اردیبهشت','خرداد','تیر','مرداد','شهریور','مهر','آبان','آذر','دی','بهمن','اسفند'];
    const weekdays = ['یکشنبه','دوشنبه','سه‌شنبه','چهارشنبه','پنجشنبه','جمعه','شنبه'];
    const weekday = weekdays[date.getDay()];
    return {
      weekday,
      full: `${toPersianNumbers(j.jd)} ${months[j.jm-1]} ${toPersianNumbers(j.jy)}`
    };
  }

  async function fetchHijriByGregorian(date) {
    const ddmmyyyy = `${pad(date.getDate())}-${pad(date.getMonth()+1)}-${date.getFullYear()}`;
    const url = `https://api.aladhan.com/v1/gToH?date=${ddmmyyyy}`;
    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error('خطا در اتصال به سرویس قمری');
      const json = await res.json();
      const hi = json?.data?.hijri;
      if (!hi) throw new Error('پاسخی دریافت نشد');
      
      const monthNames = {
        'Muharram': 'محرم', 'Safar': 'صفر', 'Rabi al-Awwal': 'ربیع‌الاول', 'Rabi al-Thani': 'ربیع‌الثانی',
        'Jumada al-Awwal': 'جمادی‌الاول', 'Jumada al-Thani': 'جمادی‌الثانی', 'Rajab': 'رجب', 'Sha\'ban': 'شعبان',
        'Ramadan': 'رمضان', 'Shawwal': 'شوال', 'Dhu al-Qi\'dah': 'ذی‌القعده', 'Dhu al-Hijjah': 'ذی‌الحجه'
      };
      
      const monthName = monthNames[hi.month.en] || hi.month.ar;
      const nameFa = `${toPersianNumbers(hi.day)} ${monthName} ${toPersianNumbers(hi.year)}`;
      const weekdayFa = hi.weekday.ar || hi.weekday.en || '';
      return {fullFa: nameFa, weekdayFa};
    } catch (error) {
      console.error('Error fetching Hijri date:', error);
      throw error;
    }
  }

  async function initToday() {
    const now = new Date();
    const gEn = formatGregorian(now, 'en-GB');
    document.getElementById('enToday').textContent = gEn;
    document.getElementById('enWeekday').textContent = now.toLocaleDateString('en-GB', {weekday: 'long'});
    const j = toJalaliString(now);
    document.getElementById('faToday').textContent = j.full;
    document.getElementById('faWeekday').textContent = j.weekday;
    const hiLoader = document.getElementById('hiLoading');
    const hiErr = document.getElementById('hiError');
    hiLoader.style.display = 'block';
    hiErr.textContent = '';
    try {
      const hi = await fetchHijriByGregorian(now);
      document.getElementById('hiToday').textContent = hi.fullFa;
      document.getElementById('hiWeekday').textContent = hi.weekdayFa;
    } catch (e) {
      hiErr.textContent = e.message || 'مشکل در دریافت تاریخ قمری.';
    } finally {
      hiLoader.style.display = 'none';
    }
  }

  async function convertPicked() {
    const inp = document.getElementById('pick');
    const cvFa = document.getElementById('cvFa');
    const cvEn = document.getElementById('cvEn');
    const cvHi = document.getElementById('cvHi');
    const cvErr = document.getElementById('cvErr');
    const loader = document.getElementById('cvLoading');

    if (!inp.value) {
      cvFa.textContent = '—'; cvEn.textContent = '—'; cvHi.textContent = '—'; cvErr.textContent = '';
      return;
    }

    const [y,m,d] = inp.value.split('-').map(Number);
    const dt = new Date(y, m-1, d);
    cvEn.textContent = formatGregorian(dt, 'en-GB');
    cvFa.textContent = toJalaliString(dt).full;
    loader.style.display = 'block';
    cvErr.textContent = '';
    cvHi.textContent = '—';
    try {
      const hi = await fetchHijriByGregorian(dt);
      cvHi.textContent = hi.fullFa;
    } catch (e) {
      cvErr.textContent = e.message || 'دریافت تاریخ قمری ناموفق بود.';
    } finally {
      loader.style.display = 'none';
    }
  }
  // END: JS for new calendar component
  
  // START: JS for new Feed/Post component
    const POSTS_JSON_URL = 'https://raw.githubusercontent.com/mahyarasadi1390/Heiat-news/main/Posts.json';

    function toPersianDate(dateString) {
        const date = new Date(dateString);
        const options = { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric',
            calendar: 'persian',
            numberingSystem: 'arab'
        };
        
        try {
            return new Intl.DateTimeFormat('fa-IR', options).format(date);
        } catch (e) {
            return date.toLocaleDateString('fa-IR');
        }
    }

    async function loadPosts() {
        const loadingElement = document.getElementById('loading');
        const errorElement = document.getElementById('error');
        const postListElement = document.getElementById('postList');

        // Reset state before fetching
        loadingElement.style.display = 'block';
        errorElement.style.display = 'none';
        postListElement.style.display = 'none';
        postListElement.innerHTML = '';

        try {
            const response = await fetch(POSTS_JSON_URL);
            
            if (!response.ok) {
                throw new Error(`خطا در دریافت داده‌ها: ${response.status}`);
            }

            const postsData = await response.json();
            
            if (!postsData.posts || !Array.isArray(postsData.posts)) {
                throw new Error('فرمت داده‌ها نامعتبر است');
            }

            loadingElement.style.display = 'none';
            postListElement.style.display = 'grid';

            const sortedPosts = postsData.posts.sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );

            let html = '';
            sortedPosts.forEach(post => {
                const persianDate = toPersianDate(post.date);
                
                html += `
                    <div class="post-item">
                        <h2 class="post-title">
                            ${post.title}
                            ${post.category ? `<span class="category-badge">${post.category}</span>` : ''}
                        </h2>
                        
                        <p class="post-excerpt">${post.excerpt || post.content.substring(0, 150)}...</p>
                        
                        <div class="post-meta">
                            <div class="post-date">
                                <i class="far fa-calendar"></i> 
                                ${persianDate}
                            </div>
                        </div>
                    </div>
                `;
            });

            postListElement.innerHTML = html;

        } catch (error) {
            console.error('Error loading posts:', error);
            loadingElement.style.display = 'none';
            errorElement.style.display = 'block';
            errorElement.innerHTML = `
                <i class="fas fa-exclamation-triangle"></i>
                <h3>خطا در بارگذاری پست‌ها</h3>
                <p>${error.message}</p>
                <button onclick="loadPosts()" style="
                    background: var(--secondary-color);
                    color: #000;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 6px;
                    cursor: pointer;
                    margin-top: 15px;
                ">تلاش مجدد</button>
            `;
        }
    }
  // END: JS for new Feed/Post component


  // لیست شهرهای ایران
  const cities = [
    "آبادان","آباده","آذرشهر","آشتیان","آمل","ابهر","اردبیل","اردستان","ارومیه","اراک",
    "اسدآباد","اسفراین","اسلام‌آباد غرب","اسلامشهر","اشنویه","اصفهان","اقلید","الیگودرز","امام‌شهر",
    "امیدیه","اندیمشک","اهواز","ایلام","بابل","بافت","بجنورد","برازجان","بردسیر","بروجن","بروجرد",
    "بندرعباس","بندر انزلی","بندر ترکمن","بوئین زهرا","بوکان","بوشهر","بیجار","بیرجند","تبریز",
    "تربت جام","تربت حیدریه","تسوج","تفرش","تفت","تهران","تویسرکان","جاسک","جاجرم","جهرم","جیرفت",
    "چابهار","خرم‌آباد","خرمشهر","خوی","دره‌شهر","دزفول","دماوند","دورود","دهلران","رامهرمز","رامسر",
    "رشت","رفسنجان","رودبار","رودسر","ری","زابل","زاهدان","زنجان","زرند","سبزوار","ساری","ساوه",
    "سرباز","سراب","سردشت","سرپل ذهاب","سقز","سنندج","سمنان","سیرجان","شاهرود","شازند","شوش",
    "شوشتر","شیراز","شهربابک","شهرضا","صحنه","قائم‌شهر","قروه","قزوین","قم","قائن","قشم","قوچان",
    "کردکوی","کرج","کرمان","کرمانشاه","کلات","کنگاور","کهگیلویه","کیش","گراش","گرگان","گناباد",
    "گنبد کاووس","لاهیجان","لردگان","ماکو","ماهشهر","مراغه","مرند","مریوان","مشهد","ملایر","منجیل",
    "منوجان","مهاباد","مهران","مهریز","میناب","نائین","نکا","نیشابور","نور","نهاوند","نهبندان",
    "نوشهر","هشتگرد","همدان","هرات","هرمزگان","هریس","هفشجان","هندیجان","یزد"
  ];

  // مرتب‌سازی و اضافه کردن شهرها به dropdown
  const citySelect = document.getElementById('city');
  cities.sort().forEach(city => {
    const option = document.createElement('option');
    option.value = city;
    option.textContent = city;
    citySelect.appendChild(option);
    
    // انتخاب پیش‌فرض تهران
    if (city === "تهران") {
      option.selected = true;
    }
  });

  async function getTimings() {
    const city = citySelect.value;
    const method = document.getElementById('method').value;
    const loadingElement = document.getElementById('loading');
    const errorElement = document.getElementById('error');
    const resultElement = document.getElementById('result');
    
    // پنهان کردن نتیجه قبلی و نمایش حالت بارگذاری
    errorElement.style.display = 'none';
    resultElement.style.display = 'none';
    loadingElement.style.display = 'block';
    
    if (!city) {
      showError('لطفاً یک شهر انتخاب کنید.');
      return;
    }
    
    try {
      const response = await fetch(`https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(city)}&country=Iran&method=${method}`);
      
      if (!response.ok) {
        throw new Error('خطا در دریافت اطلاعات از سرور');
      }
      
      const data = await response.json();
      
      if (data.code === 200 && data.data) {
        displayTimings(data.data, city);
      } else {
        throw new Error(data.data.message || 'اطلاعات اوقات شرعی یافت نشد');
      }
    } catch (error) {
      console.error('Error:', error);
      showError(error.message || 'خطا در دریافت اوقات شرعی. لطفاً دوباره تلاش کنید.');
    } finally {
      loadingElement.style.display = 'none';
    }
  }
  
  function showError(message) {
    const errorElement = document.getElementById('error');
    errorElement.textContent = message;
    errorElement.style.display = 'block';
  }
  
  function displayTimings(data, city) {
    const timings = data.timings;
    const resultElement = document.getElementById('result');
    const prayerTimesContainer = document.getElementById('prayerTimesContainer');
    
    // نمایش نام شهر
    document.getElementById('cityTitle').textContent = `اوقات شرعی ${city}`;
    
    // ایجاد کارت‌های اوقات شرعی
    prayerTimesContainer.innerHTML = '';
    
    const prayerTimes = [
      { name: 'اذان صبح', key: 'Fajr' },
      { name: 'طلوع آفتاب', key: 'Sunrise' },
      { name: 'اذان ظهر', key: 'Dhuhr' },
      { name: 'اذان عصر', key: 'Asr' },
      { name: 'غروب آفتاب', key: 'Sunset' },
      { name: 'اذان مغرب', key: 'Maghrib' },
      { name: 'اذان عشاء', key: 'Isha' },
      { name: 'نیمه شب', key: 'Midnight' }
    ];
    
    prayerTimes.forEach(prayer => {
      const prayerElement = document.createElement('div');
      prayerElement.className = 'prayer-time';
      
      const now = new Date();
      const currentTime = now.getHours() * 100 + now.getMinutes();
      const prayerTime = convertTimeToNumber(timings[prayer.key]);
      
      if (currentTime >= prayerTime && currentTime < prayerTime + 20) {
        prayerElement.classList.add('active');
      }
      
      prayerElement.innerHTML = `
        <span class="prayer-name">${prayer.name}</span>
        <span class="prayer-value">${timings[prayer.key]}</span>
      `;
      
      prayerTimesContainer.appendChild(prayerElement);
    });
    
    // نمایش تاریخ‌ها
    document.getElementById('gregorianDate').textContent = data.date.gregorian.date;
    document.getElementById('hijriDate').textContent = data.date.hijri.date;
    
    // تبدیل تاریخ میلادی به شمسی
    const gregorianDateParts = data.date.gregorian.date.split('-');
    const shamsiDate = toJalali(
      parseInt(gregorianDateParts[2]), 
      parseInt(gregorianDateParts[1]), 
      parseInt(gregorianDateParts[0])
    );
    document.getElementById('shamsiDate').textContent = shamsiDate;
    
    // نمایش نتایج
    resultElement.style.display = 'block';
  }
  
  // تبدیل زمان به عدد برای مقایسه (مثلا "05:30" به 530)
  function convertTimeToNumber(timeStr) {
    const [hours, minutes] = timeStr.split(':').map(Number);
    return hours * 100 + minutes;
  }
  
  // تابع تبدیل تاریخ میلادی به شمسی
  function toJalali(gy, gm, gd) {
    const g_d_m = [0,31,59,90,120,151,181,212,243,273,304,334];
    let jy = (gy <= 1600) ? 0 : 979;
    gy -= (gy <= 1600) ? 621 : 1600;
    const gy2 = (gm > 2) ? (gy + 1) : gy;
    let days = (365 * gy) + Math.floor((gy2 + 3) / 4) - Math.floor((gy2 + 99) / 100) +
              Math.floor((gy2 + 399) / 400) - 80 + gd + g_d_m[gm - 1];
    jy += 33 * Math.floor(days / 12053);
    days %= 12053;
    jy += 4 * Math.floor(days / 1461);
    days %= 1461;
    jy += Math.floor((days - 1) / 365);
    if (days > 365) days = (days - 1) % 365;
    const jm = (days < 186) ? Math.ceil((days + 1) / 31) : Math.ceil((days - 186) / 30) + 6;
    const jd = days - ((jm < 7) ? ((jm - 1) * 31) : ((jm - 7) * 30)) + 1;
    
    const monthNames = ['فروردین', 'اردیبهشت', 'خرداد', 'تیر', 'مرداد', 'شهریور', 
                      'مهر', 'آبان', 'آذر', 'دی', 'بهمن', 'اسفند'];
    
    return `${jd} ${monthNames[jm-1]} ${jy}`;
  }

  // Dynamic CSS variables for hover effects
  document.documentElement.style.setProperty('--primary-color-rgb', hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--primary-color')));
  document.documentElement.style.setProperty('--secondary-color-rgb', hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--secondary-color')));
  document.documentElement.style.setProperty('--bg-color-rgb', hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--bg-color')));

  function hexToRgb(hex) {
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return `${r}, ${g}, ${b}`;
  }

  // Back to top button and Bottom Nav visibility
  window.addEventListener('scroll', function() {
    const backToTop = document.querySelector('.back-to-top');
    const bottomNav = document.getElementById('bottomNav');
    const scrollY = window.scrollY;

    if (scrollY > 300) {
      backToTop.classList.add('visible');
    } else {
      backToTop.classList.remove('visible');
    }
    
    if (scrollY > 200) {
      bottomNav.classList.add('visible');
    } else {
      bottomNav.classList.remove('visible');
    }
  });

  // Theme toggle functionality
  function toggleTheme() {
    document.body.classList.toggle('light-mode');
    localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
    document.documentElement.style.setProperty('--primary-color-rgb', hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--primary-color')));
    document.documentElement.style.setProperty('--secondary-color-rgb', hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--secondary-color')));
    document.documentElement.style.setProperty('--bg-color-rgb', hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--bg-color')));
  }

  // Remove referrer info from iframes
  document.querySelectorAll('iframe').forEach(iframe => {
    iframe.setAttribute('referrerpolicy', 'no-referrer');
  });

  // متغیرهای جدید برای مدیریت جستجو
  let searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
  let currentSearchTerm = '';
  let searchResults = [];
  let currentResultIndex = -1;
  
  // تابع نمایش تاریخچه جستجو
  function showSearchHistory() {
    const historyContainer = document.getElementById('historyItems');
    historyContainer.innerHTML = '';
    
    if (searchHistory.length === 0) {
      historyContainer.innerHTML = '<div class="search-history-item" style="color: var(--text-color); opacity: 0.7;">تاریخچه جستجو خالی است</div>';
      return;
    }
    
    // نمایش آخرین جستجوها به ترتیب معکوس (جدیدترین اول)
    searchHistory.slice().reverse().forEach(term => {
      const item = document.createElement('div');
      item.className = 'search-history-item';
      item.textContent = term;
      item.onclick = () => {
        document.getElementById('siteSearchInput').value = term;
        performSearch(term);
      };
      historyContainer.appendChild(item);
    });
    
    document.getElementById('searchHistory').classList.add('visible');
  }
  
  // تابع پنهان کردن تاریخچه جستجو
  function hideSearchHistory() {
    document.getElementById('searchHistory').classList.remove('visible');
  }
  
  // تابع انجام جستجو
  function performSearch(term = null) {
    const searchInput = document.getElementById('siteSearchInput');
    currentSearchTerm = term || searchInput.value.trim();
    
    if (!currentSearchTerm) {
      alert('لطفاً عبارتی برای جستجو وارد کنید.');
      return;
    }
    
    // ذخیره در تاریخچه جستجو (اگر تکراری نباشد)
    if (!searchHistory.includes(currentSearchTerm)) {
      searchHistory.push(currentSearchTerm);
      if (searchHistory.length > 10) {
        searchHistory.shift(); // حذف قدیمی‌ترین اگر بیش از 10 مورد باشد
      }
      localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
    }
    
    // نمایش نتایج جستجو
    displaySearchResults(currentSearchTerm);
    hideSearchHistory();
    searchInput.value = currentSearchTerm;
    
    // اسکرول به بخش نتایج
    document.getElementById('searchResultsSection').style.display = 'block';
    document.getElementById('searchResultsSection').scrollIntoView({ behavior: 'smooth' });
  }
  
  // تابع نمایش نتایج جستجو
  function displaySearchResults(term) {
    const resultsContainer = document.getElementById('searchResultsContainer');
    const noResultsMessage = document.getElementById('noResultsMessage');
    const searchNavigation = document.getElementById('searchNavigation');
    
    // داده‌های نمونه برای جستجو
    searchResults = [
      {
        title: 'برنامه‌های هفتگی حسینیه',
        link: '#programs',
        snippet: `برنامه‌های هفتگی حسینیه شامل مراسم‌های مختلف مذهبی و عزاداری است. جستجوی شما برای "${term}" در این بخش یافت شد.`
      },
      {
        title: 'مداحی‌های جدید',
        link: '#madahi',
        snippet: `مجموعه‌ای از مداحی‌های جدید در بخش مداحی‌های سایت. عبارت "${term}" در توضیحات این بخش وجود دارد.`
      },
      {
        title: 'تاریخچه تأسیس حسینیه',
        link: '#about',
        snippet: `حسینیه فدائیان ائمه اطهار در سال 1350 تأسیس شده است. جستجوی شما برای "${term}" در بخش درباره ما یافت شد.`
      },
      {
        title: 'مولودی‌های ویژه',
        link: '#mowludi',
        snippet: `مجموعه مولودی‌های ویژه در بخش مولودی‌های سایت. عبارت "${term}" در این بخش وجود دارد.`
      },
      {
        title: 'گالری تصاویر و ویدیوها',
        link: '#gallery',
        snippet: `گالری تصاویر و ویدیوهای مراسم مختلف. جستجوی شما برای "${term}" در این بخش یافت شد.`
      }
    ];
    
    // اگر نتیجه‌ای یافت نشد
    if (searchResults.length === 0) {
      noResultsMessage.textContent = `نتیجه‌ای برای "${term}" یافت نشد.`;
      noResultsMessage.style.display = 'block';
      resultsContainer.innerHTML = '';
      searchNavigation.style.display = 'none';
      return;
    }
    
    noResultsMessage.style.display = 'none';
    
    // نمایش نتایج
    let html = '';
    searchResults.forEach((result, index) => {
      // هایلایت کردن عبارت جستجو شده در نتایج
      const highlightedTitle = result.title.replace(new RegExp(term, 'gi'), match => 
        `<span class="highlight-search">${match}</span>`);
      const highlightedSnippet = result.snippet.replace(new RegExp(term, 'gi'), match => 
        `<span class="highlight-search">${match}</span>`);
      
      html += `
        <div class="search-result-item" id="search-result-${index}">
          <h3 class="search-result-title">${highlightedTitle}</h3>
          <a href="${result.link}" class="search-result-link">${window.location.href.split('#')[0]}${result.link}</a>
          <p class="search-result-snippet">${highlightedSnippet}</p>
        </div>
      `;
    });
    
    resultsContainer.innerHTML = html;
    
    // فعال کردن ناوبری جستجو
    searchNavigation.style.display = 'flex';
    document.getElementById('resultCounter').textContent = `1 از ${searchResults.length}`;
    currentResultIndex = 0;
    highlightCurrentResult();
    
    // تنظیم وضعیت دکمه‌های ناوبری
    document.getElementById('prevResultBtn').disabled = true;
    document.getElementById('nextResultBtn').disabled = searchResults.length <= 1;
    
    // اضافه کردن رویدادها برای دکمه‌های ناوبری
    document.getElementById('prevResultBtn').onclick = showPreviousResult;
    document.getElementById('nextResultBtn').onclick = showNextResult;
  }
  
  // تابع پاک کردن تاریخچه جستجو
  function clearSearchHistory() {
    searchHistory = [];
    localStorage.removeItem('searchHistory');
    showSearchHistory();
  }
  
  // تابع هایلایت کردن نتیجه جستجوی فعلی
  function highlightCurrentResult() {
    // حذف هایلایت از همه نتایج
    document.querySelectorAll('.search-result-item').forEach(item => {
      item.style.backgroundColor = '';
      item.style.borderLeft = '';
    });
    
    // هایلایت نتیجه فعلی
    const currentResult = document.getElementById(`search-result-${currentResultIndex}`);
    if (currentResult) {
      currentResult.style.backgroundColor = 'rgba(var(--secondary-color-rgb), 0.1)';
      currentResult.style.borderLeft = '4px solid var(--secondary-color)';
      currentResult.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    
    // به‌روزرسانی شمارنده
    document.getElementById('resultCounter').textContent = `${currentResultIndex + 1} از ${searchResults.length}`;
  }
  
  // تابع نمایش نتیجه قبلی
  function showPreviousResult() {
    if (currentResultIndex > 0) {
      currentResultIndex--;
      highlightCurrentResult();
      document.getElementById('nextResultBtn').disabled = false;
      if (currentResultIndex === 0) {
        document.getElementById('prevResultBtn').disabled = true;
      }
    }
  }
  
  // تابع نمایش نتیجه بعدی
  function showNextResult() {
    if (currentResultIndex < searchResults.length - 1) {
      currentResultIndex++;
      highlightCurrentResult();
      document.getElementById('prevResultBtn').disabled = false;
      if (currentResultIndex === searchResults.length - 1) {
        document.getElementById('nextResultBtn').disabled = true;
      }
    }
  }

  let currentDate = new Date();
  let currentSurah = null;
  let showPersianTranslations = true;
  let showEnglishTranslations = true;

  // Toggle overlay visibility
  function toggleOverlay(id) {
      document.querySelectorAll('.overlay').forEach(el => {
          if (el.id !== id) {
              el.classList.remove('show');
              if (el.id === 'haramOnlineOverlay') {
                  document.getElementById('haramStreamIframe').src = '';
                  document.getElementById('haramStreamIframe').style.display = 'none';
                  document.getElementById('haramStreamPlaceholder').style.display = 'flex';
              }
          }
      });
      
      const overlay = document.getElementById(id);
      overlay.classList.toggle('show');

      if (id === 'haramOnlineOverlay' && overlay.classList.contains('show')) {
          const haramSelect = document.getElementById('haramSelect');
          if (haramSelect.value) {
              loadHaramStream(haramSelect.value);
          }
      }
  }

  function showQuranSection() {
    toggleOverlay('quranOverlay');
    if (!document.getElementById('surahSelectInner').options.length) {
      loadSurahList();
    }
    if (document.getElementById('surahSelectInner').value === "") {
        loadSurah(1);
    }
  }

  function showCalendar() {
    toggleOverlay('calendarOverlay');
    if(document.getElementById('faToday').textContent === '—') {
        initToday();
    }
    if(document.getElementById('cityTitle').textContent === '') {
        getTimings();
    }
  }

  const surahNames = [
    "الفاتحة","البقرة","آل عمران","النساء","المائدة","الأنعام","الأعراف","الأنفال","التوبة","يونس","هود","يوسف","الرعد",
    "إبراهيم","الحجر","النحل","الإسراء","الكهف","مريم","طه","الأنبياء","الحج","المؤمنون","النور","الفرقان","الشعراء","النمل",
    "القصص","العنكبوت","الروم","لقمان","السجدة","الأحزاب","سبأ","فاطر","يس","الصافات","ص","الزمر","غافر","فصلت","الشورى",
    "الزخرف","الدخان","الجاثية","الأحقاف","محمد","الفتح","الحجرات","ق","الذاريات","الطور","النجم","القمر","الرحمن","الواقعة",
    "الحديد","المجادلة","الحشر","الممتحنة","الصف","الجمعة","المنافقون","التغابن","الطلاق","التحريم","الملك","القلم","الحاقة",
    "المعارج","نوح","الجن","المزمل","المدثر","القيامة","الإنسان","المرسلات","النبأ","النازعات","عبس","التكوير","الانفطار",
    "المطففين","الانشقاق","البروج","الطارق","الأعلى","الغاشية","الفجر","البلد","الشمس","الليل","الضحى","الشرح","التين",
    "العلق","القدر","البينة","الزلزلة","العادیات","القارعة","التكاثر","العصر","الهمزة","الفيل","قريش","الماعون","الكوثر",
    "الكافرون","النصر","المسد","الإخلاص","الفلق","الناس"
  ];
  
  const surahNamesPersian = [
      "حمد","بقره","آل عمران","نساء","مائده","انعام","اعراف","انفال","توبه","یونس","هود","یوسف","رعد",
      "ابراهیم","حجر","نحل","اسراء","کهف","مریم","طه","انبیاء","حج","مؤمنون","نور","فرقان","شعراء","نمل",
      "قصص","عنکبوت","روم","لقمان","سجده","احزاب","سبأ","فاطر","یس","صافات","ص","زمر","غافر","فصلت","شوری",
      "زخرف","دخان","جاثیه","احقاف","محمد","فتح","حجرات","ق","ذاریات","طور","نجم","قمر","رحمن","واقعه",
      "حدید","مجادله","حشر","ممتحنه","صف","جمعه","منافقون","تغابن","طلاق","تحریم","ملک","قلم","حاقه",
      "معارج","نوح","جن","مزمل","مدثر","قیامه","انسان","مرسلات","نبأ","نازعات","عبس","تکویر","انفطار",
      "مطففین","انشقاق","بروج","طارق","اعلی","غاشیه","فجر","بلد","شمس","لیل","ضحی","شرح","تین",
      "علق","قدر","بینه","زلزله","عادیات","قارعه","تکاثر","عصر","همزه","فیل","قریش","ماعون","کوثر",
      "کافرون","نصر","مسد","اخلاص","فلق","ناس"
  ];

  async function loadSurahList() {
    try {
      const select = document.getElementById('surahSelectInner'); 
      for (let i = 0; i < 114; i++) {
        const option = document.createElement('option');
        option.value = i + 1;
        option.textContent = `سوره ${surahNames[i]} (${i + 1})`;
        select.appendChild(option);
      }
      
      const juzSelect = document.getElementById('juzSelect');
      for (let i = 1; i <= 30; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = `جزء ${i}`;
        juzSelect.appendChild(option);
      }
    } catch (error) {
      console.error('Error loading surah list:', error);
      document.getElementById('quranContent').innerHTML = '<p class="text-center">خطا در بارگذاری سوره‌ها. لطفاً دوباره تلاش کنید.</p>';
    }
  }

  async function loadSurah(surahId) {
    if (!surahId) return;
    
    const quranContent = document.getElementById('quranContent');
    quranContent.innerHTML = `
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
        <p>در حال بارگذاری سوره...</p>
      </div>
    `;
    
    try {
      const response = await fetch(`https://api.alquran.cloud/v1/surah/${surahId}/editions/ar.alafasy,fa.ghomayshi,en.sahih`).then(r => r.json());
      const arabicData = response.data[0];
      const farsiData = response.data[1];
      const englishData = response.data[2];

      const arabicAyahs = arabicData.ayahs;
      const farsiAyahs = farsiData.ayahs;
      const englishAyahs = englishData.ayahs;
      const surahName = arabicData.name;
      const verseCount = arabicData.numberOfAyahs;
      
      let html = `<div class="surah-header">
        <h4 class="secondary-text">${surahName}</h4>
        <p>تعداد آیات: ${verseCount}</p>
      </div>`;
      
      for (let i = 0; i < arabicAyahs.length; i++) {
        const ar = arabicAyahs[i];
        const fa = farsiAyahs[i];
        const en = englishAyahs[i];

        html += `
          <div class="verse-container quran-verse" id="verse-${ar.numberInSurah}">
            <strong>آیه ${ar.numberInSurah}</strong>
            <p class="verse-arabic">
              ${ar.text.replace(/([ۖ-ۚ])/g, '<span class="primary-text">$1</span>')}
            </p>
            ${showPersianTranslations ? `<p class="verse-translation"><b>ترجمه فارسی:</b> ${fa.text}</p>` : ''}
            ${showEnglishTranslations ? `<p class="verse-english-translation"><b>English Translation:</b> ${en.text}</p>` : ''}
            <audio controls src="${ar.audio}" style="width: 100%; margin-top: 10px;"></audio>
          </div>
        `;
      }
      
      quranContent.innerHTML = html;
      currentSurah = surahId;
    } catch (error) {
      console.error('Error loading surah:', error);
      quranContent.innerHTML = '<p class="text-center">خطا در بارگذاری محتوای سوره. لطفاً اتصال اینترنت خود را بررسی کرده و دوباره تلاش کنید.</p>';
    }
  }

  async function loadJuz(juzNumber) {
    if (!juzNumber) return;
    
    const quranContent = document.getElementById('quranContent');
    quranContent.innerHTML = `
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
        <p>در حال بارگذاری جزء ${juzNumber}...</p>
      </div>
    `;
    
    try {
      const proxyUrl = "https://cors-anywhere.herokuapp.com/";
      const apiUrl = `https://api.alquran.cloud/v1/juz/${juzNumber}/editions/ar.alafasy,fa.ghomayshi,en.sahih`;
      const response = await fetch(proxyUrl + apiUrl).then(r => r.json());
      
      const arabicData = response.data[0];
      const farsiData = response.data[1];
      const englishData = response.data[2];
      
      let html = `<h4 class="secondary-text text-center">جزء ${juzNumber}</h4>`;
      
      for (let i = 0; i < arabicData.ayahs.length; i++) {
        const ar = arabicData.ayahs[i];
        const fa = farsiData.ayahs[i];
        const en = englishData.ayahs[i];

        html += `
          <div class="verse-container quran-verse">
            <strong>سوره ${surahNames[ar.surah.number - 1]} - آیه ${ar.numberInSurah}</strong>
            <p class="verse-arabic">
              ${ar.text.replace(/([ۖ-ۚ])/g, '<span class="primary-text">$1</span>')}
            </p>
            ${showPersianTranslations ? `<p class="verse-translation"><b>ترجمه فارسی:</b> ${fa.text}</p>` : ''}
            ${showEnglishTranslations ? `<p class="verse-english-translation"><b>English Translation:</b> ${en.text}</p>` : ''}
            <audio controls src="${ar.audio}" style="width: 100%; margin-top: 10px;"></audio>
          </div>
        `;
      }
      
      quranContent.innerHTML = html;
    } catch (error) {
      console.error('Error loading juz:', error);
      quranContent.innerHTML = '<p class="text-center">خطا در بارگذاری جزء. لطفاً دوباره تلاش کنید.</p>';
    }
  }
  
  function findSurahNumberByName(name) {
      const normalizedName = name.trim();
      const index = surahNamesPersian.indexOf(normalizedName);
      return index !== -1 ? index + 1 : null;
  }

  async function loadSpecificVerse(surahNumber, ayahNumber) {
    const quranContent = document.getElementById('quranContent');
    quranContent.innerHTML = `
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
        <p>در حال بارگذاری آیه ${ayahNumber} سوره ${surahNames[surahNumber-1]}...</p>
      </div>
    `;
    
    try {
        const response = await fetch(`https://api.alquran.cloud/v1/ayah/${surahNumber}:${ayahNumber}/editions/ar.alafasy,fa.ghomayshi,en.sahih`).then(r => r.json());
        
        if (response.code !== 200) {
            throw new Error(response.data || "آیه مورد نظر یافت نشد.");
        }

        const ar = response.data[0];
        const fa = response.data[1];
        const en = response.data[2];
        
        let html = `<h4 class="secondary-text text-center">آیه ${ayahNumber} سوره ${ar.surah.name}</h4>`;
        html += `
          <div class="verse-container quran-verse" id="verse-${ar.numberInSurah}">
            <strong>آیه ${ar.numberInSurah}</strong>
            <p class="verse-arabic">
              ${ar.text.replace(/([ۖ-ۚ])/g, '<span class="primary-text">$1</span>')}
            </p>
            ${showPersianTranslations ? `<p class="verse-translation"><b>ترجمه فارسی:</b> ${fa.text}</p>` : ''}
            ${showEnglishTranslations ? `<p class="verse-english-translation"><b>English Translation:</b> ${en.text}</p>` : ''}
            <audio controls src="${ar.audio}" style="width: 100%; margin-top: 10px;"></audio>
          </div>
        `;
        
        quranContent.innerHTML = html;
    } catch (error) {
        console.error('Error loading specific verse:', error);
        quranContent.innerHTML = `<p class="text-center">خطا در بارگذاری آیه. ممکن است شماره آیه در این سوره موجود نباشد.</p><p class="text-center">${error.message}</p>`;
    }
  }

  async function searchInQuran() {
    const query = document.getElementById('quranSearch').value.trim();
    if (!query) {
      alert('لطفاً عبارتی برای جستجو وارد کنید.');
      return;
    }
    
    const quranContent = document.getElementById('quranContent');
    quranContent.innerHTML = `
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
        <p>در حال جستجو برای "${query}"...</p>
      </div>
    `;

    const nameVersePattern = /^(?:سوره\s*)?([^\d\s]+)\s*(?:آیه\s*)?(\d+)$/;
    const nameVerseMatch = query.match(nameVersePattern);
    if (nameVerseMatch) {
        const surahName = nameVerseMatch[1];
        const ayahNumber = nameVerseMatch[2];
        const surahNumber = findSurahNumberByName(surahName);
        if (surahNumber) {
            loadSpecificVerse(surahNumber, ayahNumber);
            return;
        }
    }

    const numVersePattern = /^(\d+)[\s:.](\d+)$/;
    const numVerseMatch = query.match(numVersePattern);
    if (numVerseMatch) {
        const surahNumber = numVerseMatch[1];
        const ayahNumber = numVerseMatch[2];
        loadSpecificVerse(surahNumber, ayahNumber);
        return;
    }
    
    try {
      const response = await fetch(`https://api.alquran.cloud/v1/search/${encodeURIComponent(query)}/all/editions/ar.alafasy,fa.ghomayshi,en.sahih`).then(r => r.json());
      
      const arabicMatches = response.data[0].matches;
      const farsiMatches = response.data[1].matches;
      const englishMatches = response.data[2].matches;

      if (arabicMatches.length === 0) {
        quranContent.innerHTML = '<p class="text-center">نتیجه‌ای یافت نشد.</p>';
        return;
      }
      
      let html = `<h4 class="secondary-text text-center">نتایج جستجو برای "${query}"</h4>`;
      
      arabicMatches.forEach((match, index) => {
        const farsiMatch = farsiMatches[index];
        const englishMatch = englishMatches[index];
        
        let highlightedArabic = match.text.replace(new RegExp(query, 'gi'), `<span class="highlight">$&</span>`);
        let highlightedFarsiTranslation = farsiMatch ? farsiMatch.text.replace(new RegExp(query, 'gi'), `<span class="highlight">$&</span>`) : 'ترجمه فارسی در دسترس نیست.';
        let highlightedEnglishTranslation = englishMatch ? englishMatch.text.replace(new RegExp(query, 'gi'), `<span class="highlight">$&</span>`) : 'English translation not available.';

        html += `
          <div class="verse-container quran-verse" id="search-${match.number}">
            <strong>سوره ${surahNames[match.surah.number - 1]} - آیه ${match.numberInSurah}</strong>
            <p class="verse-arabic">
              ${highlightedArabic.replace(/([ۖ-ۚ])/g, '<span class="primary-text">$1</span>')}
            </p>
            ${showPersianTranslations ? `<p class="verse-translation"><b>ترجمه فارسی:</b> ${highlightedFarsiTranslation}</p>` : ''}
            ${showEnglishTranslations ? `<p class="verse-english-translation"><b>English Translation:</b> ${highlightedEnglishTranslation}</p>` : ''}
            <audio controls src="${match.audio}" style="width: 100%; margin-top: 10px;"></audio>
          </div>
        `;
      });
      
      quranContent.innerHTML = html;
      
    } catch (error) {
      console.error('Error in Quran search:', error);
      quranContent.innerHTML = '<p class="text-center">خطا در انجام جستجو. لطفاً دوباره تلاش کنید.</p>';
    }
  }

  function toggleTranslation(language) {
    if (language === 'persian') {
      showPersianTranslations = !showPersianTranslations;
      document.querySelectorAll('.verse-translation').forEach(el => {
        el.style.display = showPersianTranslations ? 'block' : 'none';
      });
      alert(`نمایش ترجمه فارسی: ${showPersianTranslations ? 'فعال' : 'غیرفعال'}`);
    } else if (language === 'english') {
      showEnglishTranslations = !showEnglishTranslations;
      document.querySelectorAll('.verse-english-translation').forEach(el => {
        el.style.display = showEnglishTranslations ? 'block' : 'none';
      });
      alert(`Display English Translation: ${showEnglishTranslations ? 'Enabled' : 'Disabled'}`);
    }
  }

  function toggleAudio() {
    alert('پخش صوتی آیات به صورت پیش‌فرض در هر آیه وجود دارد.');
  }

  function bookmarkVerse() {
    const currentVerse = document.querySelector('.verse-container:target') || document.querySelector('.verse-container');
    if (!currentVerse) return;
    
    const verseId = currentVerse.id.split('-')[1];
    const surahSelect = document.getElementById('surahSelectInner');
    const surahNumber = surahSelect.value;
    const surahName = surahSelect.options[surahSelect.selectedIndex].text.split(' ')[1];
    
    const bookmark = {
      surahNumber,
      surahName,
      verseNumber: verseId,
      timestamp: new Date().toISOString()
    };
    
    localStorage.setItem('lastQuranBookmark', JSON.stringify(bookmark));
    alert(`آیه ${verseId} سوره ${surahName} ذخیره شد.`);
  }

  function scrollToTop() {
    window.scrollTo({top: 0, behavior: 'smooth'});
  }

  function toggleFeed() {
    toggleOverlay('feedOverlay');
    // Load posts only if the container is empty, to avoid reloading on every click
    const postList = document.getElementById('postList');
    if (postList && !postList.hasChildNodes()) {
        loadPosts();
    }
  }

  function showHaramOnlineSection() {
    toggleOverlay('haramOnlineOverlay');
    const haramSelect = document.getElementById('haramSelect');
    if (haramSelect.value) {
      loadHaramStream(haramSelect.value);
    } else {
      document.getElementById('haramStreamPlaceholder').style.display = 'flex';
      document.getElementById('haramStreamIframe').src = '';
    }
  }

  function loadHaramStream(url) {
    const iframe = document.getElementById('haramStreamIframe');
    const placeholder = document.getElementById('haramStreamPlaceholder');
    if (url) {
      iframe.src = url;
      iframe.style.display = 'block'; 
      placeholder.style.display = 'none'; 
    } else {
      iframe.src = '';
      iframe.style.display = 'none'; 
      placeholder.style.display = 'flex'; 
    }
  }

  function handleCustomURLs() {
    const path = window.location.pathname;
    
    if (/^\/quranj\d+$/i.test(path)) {
      const juzNumber = parseInt(path.replace(/\/quranj/i, ''));
      if (juzNumber >= 1 && juzNumber <= 30) {
        showQuranSection();
        loadJuz(juzNumber);
      }
    }
    else if (/^\/s\d+a\d+$/i.test(path)) {
      const matches = path.match(/\/s(\d+)a(\d+)/i);
      const surahNumber = parseInt(matches[1]);
      const ayahNumber = parseInt(matches[2]);
      
      if (surahNumber >= 1 && surahNumber <= 114) {
        showQuranSection();
        loadSpecificVerse(surahNumber, ayahNumber);
      }
    }
  }

  function checkBookmarkReminder() {
    const bookmark = JSON.parse(localStorage.getItem('lastQuranBookmark'));
    if (!bookmark) return;

    const reminderHtml = `
      <div id="bookmarkReminder" style="
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--card-bg);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        z-index: 10000;
        text-align: center;
        max-width: 90%;
        width: 400px;
      ">
        <h4 style="color: var(--secondary-color); margin-top: 0;">
          <i class="fas fa-bookmark"></i> یادآوری
        </h4>
        <p>آخرین بار تا آیه ${bookmark.verseNumber} سوره ${bookmark.surahName} مطالعه کردید.</p>
        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
          <button onclick="continueReading(${bookmark.surahNumber}, ${bookmark.verseNumber})" 
                  style="background: var(--primary-color); color: white; border: none; padding: 8px 15px; border-radius: 5px;">
            ادامه خواندن
          </button>
          <button onclick="document.getElementById('bookmarkReminder').remove()" 
                  style="background: var(--border-color); color: var(--text-color); border: none; padding: 8px 15px; border-radius: 5px;">
            بعداً یادآوری کن
          </button>
        </div>
      </div>
    `;

    document.body.insertAdjacentHTML('beforeend', reminderHtml);
  }

  function continueReading(surahNumber, verseNumber) {
    document.getElementById('bookmarkReminder').remove();
    loadSurah(surahNumber);
    
    setTimeout(() => {
      const verseElement = document.getElementById(`verse-${verseNumber}`);
      if (verseElement) {
        verseElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        verseElement.style.animation = 'highlight 2s ease';
      }
    }, 1000);
  }

  // تابع فیلتر گالری بر اساس دسته‌بندی
  function filterGallery(category) {
    const galleryItems = document.querySelectorAll('.gallery-item');
    const buttons = document.querySelectorAll('.gallery-category-btn');
    
    // حذف کلاس active از همه دکمه‌ها
    buttons.forEach(btn => {
      btn.classList.remove('active');
    });
    
    // اضافه کردن کلاس active به دکمه انتخاب شده
    event.target.classList.add('active');
    
    galleryItems.forEach(item => {
      if (category === 'all' || item.dataset.category === category) {
        item.style.display = 'block';
      } else {
        item.style.display = 'none';
      }
    });
  }

  // تابع مرتب‌سازی گالری بر اساس تاریخ
  function sortGalleryByDate() {
    const galleryCategories = document.querySelectorAll('.gallery-category');
    
    galleryCategories.forEach(category => {
      const gallery = category.querySelector('.gallery');
      const items = Array.from(gallery.querySelectorAll('.gallery-item'));
      
      items.sort((a, b) => {
        const dateA = a.dataset.date.split('/').join('');
        const dateB = b.dataset.date.split('/').join('');
        return dateB - dateA; // مرتب‌سازی نزولی (جدید به قدیم)
      });
      
      // حذف همه آیتم‌ها
      items.forEach(item => item.remove());
      
      // اضافه کردن مجدد آیتم‌ها به ترتیب جدید
      items.forEach(item => gallery.appendChild(item));
    });
  }

  window.addEventListener('DOMContentLoaded', function() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'light') {
      document.body.classList.add('light-mode');
    }
    
    document.documentElement.style.setProperty('--primary-color-rgb', hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--primary-color')));
    document.documentElement.style.setProperty('--secondary-color-rgb', hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--secondary-color')));
    document.documentElement.style.setProperty('--bg-color-rgb', hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--bg-color')));
    
    // رویدادهای مربوط به جستجو
    document.getElementById('siteSearchInput').addEventListener('focus', showSearchHistory);
    document.getElementById('siteSearchInput').addEventListener('blur', () => {
      setTimeout(hideSearchHistory, 200);
    });
    
    document.getElementById('siteSearchInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        performSearch();
      }
    });
    
    document.getElementById('quranSearch').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        searchInQuran();
      }
    });
    
    loadSurahList(); 
    handleCustomURLs();
    setTimeout(checkBookmarkReminder, 3000);
    sortGalleryByDate(); // مرتب‌سازی گالری بر اساس تاریخ

    // Event listener for the new calendar button
    document.getElementById('convertBtn').addEventListener('click', convertPicked);

    // Seed date input for the new calendar
    (function seedDateInput(){
        const inp = document.getElementById('pick');
        const now = new Date();
        const iso = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}`;
        inp.value = iso;
        setTimeout(convertPicked, 100);
    })();

    // Initialize the calendar today view
    if (window.jalaali) {
      initToday();
    } else {
      const checkInterval = setInterval(function() {
        if (window.jalaali) {
          clearInterval(checkInterval);
          initToday();
        }
      }, 100);
    }
  });

  function darken(color, percent) {
      let f=parseInt(color.slice(1),16),t=percent<0?0:255,p=percent<0?percent*-1:percent,R=f>>16,G=(f>>8)&0x00FF,B=f&0x0000FF;
      return "#"+(0x1000000+(Math.round((t-R)*p)+R)*0x10000+(Math.round((t-G)*p)+G)*0x100+(Math.round((t-B)*p)+B)).toString(16).slice(1);
  }
</script>
<script src="https://unpkg.com/jalaali-js/dist/jalaali.js"></script>

</body>
</html>